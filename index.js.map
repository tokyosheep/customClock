{"version":3,"sources":["webpack://customClock/./node_modules/async/lib/async.js","webpack://customClock/./node_modules/binary-search-tree/index.js","webpack://customClock/./node_modules/binary-search-tree/lib/avltree.js","webpack://customClock/./node_modules/binary-search-tree/lib/bst.js","webpack://customClock/./node_modules/binary-search-tree/lib/customUtils.js","webpack://customClock/./node_modules/mkdirp/index.js","webpack://customClock/./node_modules/nedb/index.js","webpack://customClock/./node_modules/nedb/lib/cursor.js","webpack://customClock/./node_modules/nedb/lib/customUtils.js","webpack://customClock/./node_modules/nedb/lib/datastore.js","webpack://customClock/./node_modules/nedb/lib/executor.js","webpack://customClock/./node_modules/nedb/lib/indexes.js","webpack://customClock/./node_modules/nedb/lib/model.js","webpack://customClock/./node_modules/nedb/lib/persistence.js","webpack://customClock/./node_modules/nedb/lib/storage.js","webpack://customClock/./node_modules/underscore/underscore.js","webpack://customClock/external \"crypto\"","webpack://customClock/external \"electron\"","webpack://customClock/external \"events\"","webpack://customClock/external \"fs\"","webpack://customClock/external \"path\"","webpack://customClock/external \"util\"","webpack://customClock/webpack/bootstrap","webpack://customClock/./mainProcess/index.ts","webpack://customClock/./mainProcess/ipcCommut.ts"],"names":["root","previous_async","async","only_once","fn","called","Error","apply","arguments","this","noConflict","_each","arr","iterator","forEach","i","length","_map","map","results","x","a","push","_keys","obj","Object","keys","k","hasOwnProperty","process","nextTick","setImmediate","setTimeout","each","callback","completed","err","eachSeries","iterate","forEachSeries","eachLimit","limit","_eachLimit","forEachLimit","started","running","replenish","doParallel","args","Array","prototype","slice","call","concat","doSeries","_asyncMap","eachfn","index","value","v","mapSeries","mapLimit","_mapLimit","doParallelLimit","reduce","memo","inject","foldl","reduceRight","reversed","reverse","foldr","_filter","sort","b","filter","filterSeries","select","selectSeries","_reject","reject","rejectSeries","_detect","main_callback","result","detect","detectSeries","some","any","every","all","sortBy","criteria","left","right","auto","tasks","listeners","addListener","unshift","taskComplete","task","Function","taskCallback","safeResults","rkey","requires","Math","abs","ready","listener","splice","removeListener","waterfall","constructor","wrapIterator","next","_parallel","parallel","parallelLimit","series","makeCallback","_concat","r","cb","y","concatSeries","whilst","test","doWhilst","until","doUntil","queue","worker","concurrency","_insert","q","data","pos","item","saturated","undefined","workers","empty","drain","shift","cargo","payload","working","ts","ds","_console_fn","name","console","error","log","dir","memoize","hasher","queues","memoized","pop","key","l","unmemoized","unmemoize","times","count","counter","timesSeries","compose","fns","that","newargs","nextargs","_applyEach","go","applyEach","applyEachSeries","forever","module","exports","AVLTree","BinarySearchTree","customUtils","util","options","tree","_AVLTree","parent","unique","compareKeys","defaultCompareKeysFunction","checkValueEquality","defaultCheckValueEquality","inherits","checkHeightCorrect","leftH","rightH","height","max","balanceFactor","checkBalanceFactors","checkIsAVLT","super_","checkIsBST","rightRotation","ah","bh","ch","p","leftRotation","rightTooSmall","leftTooSmall","rebalanceAlongPath","path","rotated","newRoot","insert","insertPath","currentNode","errorType","createLeftChild","createRightChild","newTree","delete","replaceWith","newData","deletePath","d","append","array","toAppend","getMaxKeyDescendant","getMaxKey","getMinKeyDescendant","getMinKey","checkAllNodesFullfillCondition","checkNodeOrdering","self","checkInternalPointers","getNumberOfKeys","res","createSimilar","leftChild","rightChild","search","getLowerBoundMatcher","query","$gte","$gt","getUpperBoundMatcher","$lte","$lt","betweenBounds","lbm","ubm","deleteIfLeaf","deleteIfOnlyOneChild","child","random","executeOnEveryNode","prettyPrint","printData","spacing","getRandomArray","n","floor","fs","_0777","parseInt","mkdirP","opts","f","made","mode","xfs","resolve","mkdir","er","code","dirname","stat","er2","isDirectory","mkdirp","sync","mkdirSync","err0","statSync","err1","Datastore","model","_","Cursor","db","execFn","_limit","skip","_skip","sortQuery","_sort","projection","_projection","project","candidates","keepId","action","_id","omit","candidate","toPush","$set","getDotValue","modify","$unset","_exec","_callback","added","skipped","getCandidates","match","direction","criterion","compare","compareThings","compareStrings","e","exec","executor","crypto","uid","len","randomBytes","ceil","toString","replace","Executor","Index","Persistence","filename","inMemoryOnly","autoload","timestampData","persistence","nodeWebkitAppName","afterSerialization","beforeDeserialization","corruptAlertThreshold","indexes","fieldName","ttlIndexes","loadDatabase","onload","getAllData","getAll","resetIndexes","reset","ensureIndex","missingFieldName","expireAfterSeconds","persistNewState","$$indexCreated","removeIndex","$$indexRemoved","addToIndexes","doc","failingIndex","remove","removeFromIndexes","updateIndexes","oldDoc","newDoc","update","revertUpdate","dontExpireStaleDocs","usableQueryKeys","indexNames","isDate","intersection","getMatching","$in","getBetweenBounds","docs","expiredDocsIds","validDocs","ttlIndexesFieldNames","valid","Date","now","getTime","_remove","preparedDoc","prepareDocumentForInsertion","_insertInCache","isArray","deepCopy","createNewId","tentativeId","createdAt","updatedAt","checkObject","_insertMultipleDocsInCache","preparedDocs","failingI","cursor","find","findOne","_update","updateQuery","multi","upsert","numReplaced","toBeInserted","modifiedDoc","modifications","updatedDocs","pluck","returnUpdatedDocs","updatedDocsDC","numRemoved","removedDocs","$$deleted","buffer","newArguments","lastArg","forceQueuing","processBuffer","projectForUnique","elt","sparse","treeOptions","insertMultipleDocs","uniq","_key","updateMultipleDocs","pairs","revert","pair","_res","node","modifierFunctions","lastStepModifierFunctions","comparisonFunctions","logicalOperators","arrayComparisonFunctions","checkKey","indexOf","o","strictKeys","isPrimitiveType","compareNSB","compareArrays","comp","min","_compareStrings","aKeys","bKeys","field","objs","fieldParts","split","isNaN","areThingsEqual","areComparable","queryKeys","queryKey","queryValue","matchQueryPart","needAKey","treatObjAsValue","firstChars","dollarFirstChars","objValue","isRegExp","c","$regex","$push","$slice","$each","start","end","$addToSet","addToSet","$pop","$pull","$inc","has","$max","$min","modifier","createModifierFunction","$ne","$nin","$exists","exists","$size","$elemMatch","$or","$and","$not","$where","isFunction","isBoolean","serialize","JSON","stringify","$$date","deserialize","rawData","parse","modifiers","m","storage","j","randomString","charAt","s","getNWAppFilename","ensureDirectoryExists","appName","relativeFilename","home","platform","env","LOCALAPPDATA","APPDATA","join","HOME","persistCachedDatabase","toPersist","crashSafeWriteFile","emit","compactDatafile","setAutocompactionInterval","interval","realInterval","stopAutocompaction","autocompactionIntervalId","setInterval","clearInterval","newDocs","appendFile","treatRawData","dataById","tdata","corruptItems","ensureDatafileIntegrity","readFile","treatedData","rename","writeFile","unlink","ensureFileDoesntExist","file","flushToStorage","flags","isDir","open","fd","fsync","errFS","close","errC","errorOnFsync","errorOnClose","tempFilename","filenameExists","oldFilenameExists","previousUnderscore","breaker","ArrayProto","ObjProto","FuncProto","nativeForEach","nativeMap","nativeReduce","nativeReduceRight","nativeFilter","nativeEvery","nativeSome","nativeIndexOf","nativeLastIndexOf","lastIndexOf","nativeIsArray","nativeKeys","nativeBind","bind","_wrapped","VERSION","context","collect","list","reduceError","initial","TypeError","identity","contains","include","target","invoke","method","isFunc","where","attrs","first","isEmpty","findWhere","Infinity","computed","shuffle","rand","shuffled","lookupIterator","group","behavior","groupBy","countBy","sortedIndex","low","high","mid","toArray","values","size","head","take","guard","last","rest","tail","drop","compact","flatten","input","shallow","output","without","difference","isSorted","seen","union","other","zip","object","from","hasIndex","range","stop","step","idx","func","partial","bindAll","funcs","functions","delay","wait","defer","throttle","timeout","previous","later","remaining","clearTimeout","debounce","immediate","callNow","once","ran","wrap","wrapper","after","invert","methods","names","extend","source","prop","pick","copy","defaults","clone","isObject","tap","interceptor","eq","aStack","bStack","className","String","global","multiline","ignoreCase","aCtor","bCtor","isEqual","isString","isElement","nodeType","isArguments","isFinite","parseFloat","isNumber","isNull","isUndefined","accum","entityMap","escape","unescape","entityRegexes","RegExp","string","property","mixin","idCounter","uniqueId","prefix","id","templateSettings","evaluate","interpolate","noMatch","escapes","escaper","template","text","settings","render","matcher","offset","variable","chain","_chain","require","__webpack_module_cache__","__webpack_require__","moduleId","__webpack_modules__","mainWindow","electron","ipcMain","dialog","app","DataStore","BrowserWindow","strage","getPath","handle","event","showOpenDialog","properties","filters","extensions","Promise","on","width","webPreferences","nodeIntegration","contextIsolation","loadURL","__dirname","webContents","openDevTools"],"mappings":"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","file":"index.js","sourcesContent":["/*global setImmediate: false, setTimeout: false, console: false */\n(function () {\n\n    var async = {};\n\n    // global on the server, window in the browser\n    var root, previous_async;\n\n    root = this;\n    if (root != null) {\n      previous_async = root.async;\n    }\n\n    async.noConflict = function () {\n        root.async = previous_async;\n        return async;\n    };\n\n    function only_once(fn) {\n        var called = false;\n        return function() {\n            if (called) throw new Error(\"Callback was already called.\");\n            called = true;\n            fn.apply(root, arguments);\n        }\n    }\n\n    //// cross-browser compatiblity functions ////\n\n    var _each = function (arr, iterator) {\n        if (arr.forEach) {\n            return arr.forEach(iterator);\n        }\n        for (var i = 0; i < arr.length; i += 1) {\n            iterator(arr[i], i, arr);\n        }\n    };\n\n    var _map = function (arr, iterator) {\n        if (arr.map) {\n            return arr.map(iterator);\n        }\n        var results = [];\n        _each(arr, function (x, i, a) {\n            results.push(iterator(x, i, a));\n        });\n        return results;\n    };\n\n    var _reduce = function (arr, iterator, memo) {\n        if (arr.reduce) {\n            return arr.reduce(iterator, memo);\n        }\n        _each(arr, function (x, i, a) {\n            memo = iterator(memo, x, i, a);\n        });\n        return memo;\n    };\n\n    var _keys = function (obj) {\n        if (Object.keys) {\n            return Object.keys(obj);\n        }\n        var keys = [];\n        for (var k in obj) {\n            if (obj.hasOwnProperty(k)) {\n                keys.push(k);\n            }\n        }\n        return keys;\n    };\n\n    //// exported async module functions ////\n\n    //// nextTick implementation with browser-compatible fallback ////\n    if (typeof process === 'undefined' || !(process.nextTick)) {\n        if (typeof setImmediate === 'function') {\n            async.nextTick = function (fn) {\n                // not a direct alias for IE10 compatibility\n                setImmediate(fn);\n            };\n            async.setImmediate = async.nextTick;\n        }\n        else {\n            async.nextTick = function (fn) {\n                setTimeout(fn, 0);\n            };\n            async.setImmediate = async.nextTick;\n        }\n    }\n    else {\n        async.nextTick = process.nextTick;\n        if (typeof setImmediate !== 'undefined') {\n            async.setImmediate = function (fn) {\n              // not a direct alias for IE10 compatibility\n              setImmediate(fn);\n            };\n        }\n        else {\n            async.setImmediate = async.nextTick;\n        }\n    }\n\n    async.each = function (arr, iterator, callback) {\n        callback = callback || function () {};\n        if (!arr.length) {\n            return callback();\n        }\n        var completed = 0;\n        _each(arr, function (x) {\n            iterator(x, only_once(function (err) {\n                if (err) {\n                    callback(err);\n                    callback = function () {};\n                }\n                else {\n                    completed += 1;\n                    if (completed >= arr.length) {\n                        callback(null);\n                    }\n                }\n            }));\n        });\n    };\n    async.forEach = async.each;\n\n    async.eachSeries = function (arr, iterator, callback) {\n        callback = callback || function () {};\n        if (!arr.length) {\n            return callback();\n        }\n        var completed = 0;\n        var iterate = function () {\n            iterator(arr[completed], function (err) {\n                if (err) {\n                    callback(err);\n                    callback = function () {};\n                }\n                else {\n                    completed += 1;\n                    if (completed >= arr.length) {\n                        callback(null);\n                    }\n                    else {\n                        iterate();\n                    }\n                }\n            });\n        };\n        iterate();\n    };\n    async.forEachSeries = async.eachSeries;\n\n    async.eachLimit = function (arr, limit, iterator, callback) {\n        var fn = _eachLimit(limit);\n        fn.apply(null, [arr, iterator, callback]);\n    };\n    async.forEachLimit = async.eachLimit;\n\n    var _eachLimit = function (limit) {\n\n        return function (arr, iterator, callback) {\n            callback = callback || function () {};\n            if (!arr.length || limit <= 0) {\n                return callback();\n            }\n            var completed = 0;\n            var started = 0;\n            var running = 0;\n\n            (function replenish () {\n                if (completed >= arr.length) {\n                    return callback();\n                }\n\n                while (running < limit && started < arr.length) {\n                    started += 1;\n                    running += 1;\n                    iterator(arr[started - 1], function (err) {\n                        if (err) {\n                            callback(err);\n                            callback = function () {};\n                        }\n                        else {\n                            completed += 1;\n                            running -= 1;\n                            if (completed >= arr.length) {\n                                callback();\n                            }\n                            else {\n                                replenish();\n                            }\n                        }\n                    });\n                }\n            })();\n        };\n    };\n\n\n    var doParallel = function (fn) {\n        return function () {\n            var args = Array.prototype.slice.call(arguments);\n            return fn.apply(null, [async.each].concat(args));\n        };\n    };\n    var doParallelLimit = function(limit, fn) {\n        return function () {\n            var args = Array.prototype.slice.call(arguments);\n            return fn.apply(null, [_eachLimit(limit)].concat(args));\n        };\n    };\n    var doSeries = function (fn) {\n        return function () {\n            var args = Array.prototype.slice.call(arguments);\n            return fn.apply(null, [async.eachSeries].concat(args));\n        };\n    };\n\n\n    var _asyncMap = function (eachfn, arr, iterator, callback) {\n        var results = [];\n        arr = _map(arr, function (x, i) {\n            return {index: i, value: x};\n        });\n        eachfn(arr, function (x, callback) {\n            iterator(x.value, function (err, v) {\n                results[x.index] = v;\n                callback(err);\n            });\n        }, function (err) {\n            callback(err, results);\n        });\n    };\n    async.map = doParallel(_asyncMap);\n    async.mapSeries = doSeries(_asyncMap);\n    async.mapLimit = function (arr, limit, iterator, callback) {\n        return _mapLimit(limit)(arr, iterator, callback);\n    };\n\n    var _mapLimit = function(limit) {\n        return doParallelLimit(limit, _asyncMap);\n    };\n\n    // reduce only has a series version, as doing reduce in parallel won't\n    // work in many situations.\n    async.reduce = function (arr, memo, iterator, callback) {\n        async.eachSeries(arr, function (x, callback) {\n            iterator(memo, x, function (err, v) {\n                memo = v;\n                callback(err);\n            });\n        }, function (err) {\n            callback(err, memo);\n        });\n    };\n    // inject alias\n    async.inject = async.reduce;\n    // foldl alias\n    async.foldl = async.reduce;\n\n    async.reduceRight = function (arr, memo, iterator, callback) {\n        var reversed = _map(arr, function (x) {\n            return x;\n        }).reverse();\n        async.reduce(reversed, memo, iterator, callback);\n    };\n    // foldr alias\n    async.foldr = async.reduceRight;\n\n    var _filter = function (eachfn, arr, iterator, callback) {\n        var results = [];\n        arr = _map(arr, function (x, i) {\n            return {index: i, value: x};\n        });\n        eachfn(arr, function (x, callback) {\n            iterator(x.value, function (v) {\n                if (v) {\n                    results.push(x);\n                }\n                callback();\n            });\n        }, function (err) {\n            callback(_map(results.sort(function (a, b) {\n                return a.index - b.index;\n            }), function (x) {\n                return x.value;\n            }));\n        });\n    };\n    async.filter = doParallel(_filter);\n    async.filterSeries = doSeries(_filter);\n    // select alias\n    async.select = async.filter;\n    async.selectSeries = async.filterSeries;\n\n    var _reject = function (eachfn, arr, iterator, callback) {\n        var results = [];\n        arr = _map(arr, function (x, i) {\n            return {index: i, value: x};\n        });\n        eachfn(arr, function (x, callback) {\n            iterator(x.value, function (v) {\n                if (!v) {\n                    results.push(x);\n                }\n                callback();\n            });\n        }, function (err) {\n            callback(_map(results.sort(function (a, b) {\n                return a.index - b.index;\n            }), function (x) {\n                return x.value;\n            }));\n        });\n    };\n    async.reject = doParallel(_reject);\n    async.rejectSeries = doSeries(_reject);\n\n    var _detect = function (eachfn, arr, iterator, main_callback) {\n        eachfn(arr, function (x, callback) {\n            iterator(x, function (result) {\n                if (result) {\n                    main_callback(x);\n                    main_callback = function () {};\n                }\n                else {\n                    callback();\n                }\n            });\n        }, function (err) {\n            main_callback();\n        });\n    };\n    async.detect = doParallel(_detect);\n    async.detectSeries = doSeries(_detect);\n\n    async.some = function (arr, iterator, main_callback) {\n        async.each(arr, function (x, callback) {\n            iterator(x, function (v) {\n                if (v) {\n                    main_callback(true);\n                    main_callback = function () {};\n                }\n                callback();\n            });\n        }, function (err) {\n            main_callback(false);\n        });\n    };\n    // any alias\n    async.any = async.some;\n\n    async.every = function (arr, iterator, main_callback) {\n        async.each(arr, function (x, callback) {\n            iterator(x, function (v) {\n                if (!v) {\n                    main_callback(false);\n                    main_callback = function () {};\n                }\n                callback();\n            });\n        }, function (err) {\n            main_callback(true);\n        });\n    };\n    // all alias\n    async.all = async.every;\n\n    async.sortBy = function (arr, iterator, callback) {\n        async.map(arr, function (x, callback) {\n            iterator(x, function (err, criteria) {\n                if (err) {\n                    callback(err);\n                }\n                else {\n                    callback(null, {value: x, criteria: criteria});\n                }\n            });\n        }, function (err, results) {\n            if (err) {\n                return callback(err);\n            }\n            else {\n                var fn = function (left, right) {\n                    var a = left.criteria, b = right.criteria;\n                    return a < b ? -1 : a > b ? 1 : 0;\n                };\n                callback(null, _map(results.sort(fn), function (x) {\n                    return x.value;\n                }));\n            }\n        });\n    };\n\n    async.auto = function (tasks, callback) {\n        callback = callback || function () {};\n        var keys = _keys(tasks);\n        if (!keys.length) {\n            return callback(null);\n        }\n\n        var results = {};\n\n        var listeners = [];\n        var addListener = function (fn) {\n            listeners.unshift(fn);\n        };\n        var removeListener = function (fn) {\n            for (var i = 0; i < listeners.length; i += 1) {\n                if (listeners[i] === fn) {\n                    listeners.splice(i, 1);\n                    return;\n                }\n            }\n        };\n        var taskComplete = function () {\n            _each(listeners.slice(0), function (fn) {\n                fn();\n            });\n        };\n\n        addListener(function () {\n            if (_keys(results).length === keys.length) {\n                callback(null, results);\n                callback = function () {};\n            }\n        });\n\n        _each(keys, function (k) {\n            var task = (tasks[k] instanceof Function) ? [tasks[k]]: tasks[k];\n            var taskCallback = function (err) {\n                var args = Array.prototype.slice.call(arguments, 1);\n                if (args.length <= 1) {\n                    args = args[0];\n                }\n                if (err) {\n                    var safeResults = {};\n                    _each(_keys(results), function(rkey) {\n                        safeResults[rkey] = results[rkey];\n                    });\n                    safeResults[k] = args;\n                    callback(err, safeResults);\n                    // stop subsequent errors hitting callback multiple times\n                    callback = function () {};\n                }\n                else {\n                    results[k] = args;\n                    async.setImmediate(taskComplete);\n                }\n            };\n            var requires = task.slice(0, Math.abs(task.length - 1)) || [];\n            var ready = function () {\n                return _reduce(requires, function (a, x) {\n                    return (a && results.hasOwnProperty(x));\n                }, true) && !results.hasOwnProperty(k);\n            };\n            if (ready()) {\n                task[task.length - 1](taskCallback, results);\n            }\n            else {\n                var listener = function () {\n                    if (ready()) {\n                        removeListener(listener);\n                        task[task.length - 1](taskCallback, results);\n                    }\n                };\n                addListener(listener);\n            }\n        });\n    };\n\n    async.waterfall = function (tasks, callback) {\n        callback = callback || function () {};\n        if (tasks.constructor !== Array) {\n          var err = new Error('First argument to waterfall must be an array of functions');\n          return callback(err);\n        }\n        if (!tasks.length) {\n            return callback();\n        }\n        var wrapIterator = function (iterator) {\n            return function (err) {\n                if (err) {\n                    callback.apply(null, arguments);\n                    callback = function () {};\n                }\n                else {\n                    var args = Array.prototype.slice.call(arguments, 1);\n                    var next = iterator.next();\n                    if (next) {\n                        args.push(wrapIterator(next));\n                    }\n                    else {\n                        args.push(callback);\n                    }\n                    async.setImmediate(function () {\n                        iterator.apply(null, args);\n                    });\n                }\n            };\n        };\n        wrapIterator(async.iterator(tasks))();\n    };\n\n    var _parallel = function(eachfn, tasks, callback) {\n        callback = callback || function () {};\n        if (tasks.constructor === Array) {\n            eachfn.map(tasks, function (fn, callback) {\n                if (fn) {\n                    fn(function (err) {\n                        var args = Array.prototype.slice.call(arguments, 1);\n                        if (args.length <= 1) {\n                            args = args[0];\n                        }\n                        callback.call(null, err, args);\n                    });\n                }\n            }, callback);\n        }\n        else {\n            var results = {};\n            eachfn.each(_keys(tasks), function (k, callback) {\n                tasks[k](function (err) {\n                    var args = Array.prototype.slice.call(arguments, 1);\n                    if (args.length <= 1) {\n                        args = args[0];\n                    }\n                    results[k] = args;\n                    callback(err);\n                });\n            }, function (err) {\n                callback(err, results);\n            });\n        }\n    };\n\n    async.parallel = function (tasks, callback) {\n        _parallel({ map: async.map, each: async.each }, tasks, callback);\n    };\n\n    async.parallelLimit = function(tasks, limit, callback) {\n        _parallel({ map: _mapLimit(limit), each: _eachLimit(limit) }, tasks, callback);\n    };\n\n    async.series = function (tasks, callback) {\n        callback = callback || function () {};\n        if (tasks.constructor === Array) {\n            async.mapSeries(tasks, function (fn, callback) {\n                if (fn) {\n                    fn(function (err) {\n                        var args = Array.prototype.slice.call(arguments, 1);\n                        if (args.length <= 1) {\n                            args = args[0];\n                        }\n                        callback.call(null, err, args);\n                    });\n                }\n            }, callback);\n        }\n        else {\n            var results = {};\n            async.eachSeries(_keys(tasks), function (k, callback) {\n                tasks[k](function (err) {\n                    var args = Array.prototype.slice.call(arguments, 1);\n                    if (args.length <= 1) {\n                        args = args[0];\n                    }\n                    results[k] = args;\n                    callback(err);\n                });\n            }, function (err) {\n                callback(err, results);\n            });\n        }\n    };\n\n    async.iterator = function (tasks) {\n        var makeCallback = function (index) {\n            var fn = function () {\n                if (tasks.length) {\n                    tasks[index].apply(null, arguments);\n                }\n                return fn.next();\n            };\n            fn.next = function () {\n                return (index < tasks.length - 1) ? makeCallback(index + 1): null;\n            };\n            return fn;\n        };\n        return makeCallback(0);\n    };\n\n    async.apply = function (fn) {\n        var args = Array.prototype.slice.call(arguments, 1);\n        return function () {\n            return fn.apply(\n                null, args.concat(Array.prototype.slice.call(arguments))\n            );\n        };\n    };\n\n    var _concat = function (eachfn, arr, fn, callback) {\n        var r = [];\n        eachfn(arr, function (x, cb) {\n            fn(x, function (err, y) {\n                r = r.concat(y || []);\n                cb(err);\n            });\n        }, function (err) {\n            callback(err, r);\n        });\n    };\n    async.concat = doParallel(_concat);\n    async.concatSeries = doSeries(_concat);\n\n    async.whilst = function (test, iterator, callback) {\n        if (test()) {\n            iterator(function (err) {\n                if (err) {\n                    return callback(err);\n                }\n                async.whilst(test, iterator, callback);\n            });\n        }\n        else {\n            callback();\n        }\n    };\n\n    async.doWhilst = function (iterator, test, callback) {\n        iterator(function (err) {\n            if (err) {\n                return callback(err);\n            }\n            if (test()) {\n                async.doWhilst(iterator, test, callback);\n            }\n            else {\n                callback();\n            }\n        });\n    };\n\n    async.until = function (test, iterator, callback) {\n        if (!test()) {\n            iterator(function (err) {\n                if (err) {\n                    return callback(err);\n                }\n                async.until(test, iterator, callback);\n            });\n        }\n        else {\n            callback();\n        }\n    };\n\n    async.doUntil = function (iterator, test, callback) {\n        iterator(function (err) {\n            if (err) {\n                return callback(err);\n            }\n            if (!test()) {\n                async.doUntil(iterator, test, callback);\n            }\n            else {\n                callback();\n            }\n        });\n    };\n\n    async.queue = function (worker, concurrency) {\n        if (concurrency === undefined) {\n            concurrency = 1;\n        }\n        function _insert(q, data, pos, callback) {\n          if(data.constructor !== Array) {\n              data = [data];\n          }\n          _each(data, function(task) {\n              var item = {\n                  data: task,\n                  callback: typeof callback === 'function' ? callback : null\n              };\n\n              if (pos) {\n                q.tasks.unshift(item);\n              } else {\n                q.tasks.push(item);\n              }\n\n              if (q.saturated && q.tasks.length === concurrency) {\n                  q.saturated();\n              }\n              async.setImmediate(q.process);\n          });\n        }\n\n        var workers = 0;\n        var q = {\n            tasks: [],\n            concurrency: concurrency,\n            saturated: null,\n            empty: null,\n            drain: null,\n            push: function (data, callback) {\n              _insert(q, data, false, callback);\n            },\n            unshift: function (data, callback) {\n              _insert(q, data, true, callback);\n            },\n            process: function () {\n                if (workers < q.concurrency && q.tasks.length) {\n                    var task = q.tasks.shift();\n                    if (q.empty && q.tasks.length === 0) {\n                        q.empty();\n                    }\n                    workers += 1;\n                    var next = function () {\n                        workers -= 1;\n                        if (task.callback) {\n                            task.callback.apply(task, arguments);\n                        }\n                        if (q.drain && q.tasks.length + workers === 0) {\n                            q.drain();\n                        }\n                        q.process();\n                    };\n                    var cb = only_once(next);\n                    worker(task.data, cb);\n                }\n            },\n            length: function () {\n                return q.tasks.length;\n            },\n            running: function () {\n                return workers;\n            }\n        };\n        return q;\n    };\n\n    async.cargo = function (worker, payload) {\n        var working     = false,\n            tasks       = [];\n\n        var cargo = {\n            tasks: tasks,\n            payload: payload,\n            saturated: null,\n            empty: null,\n            drain: null,\n            push: function (data, callback) {\n                if(data.constructor !== Array) {\n                    data = [data];\n                }\n                _each(data, function(task) {\n                    tasks.push({\n                        data: task,\n                        callback: typeof callback === 'function' ? callback : null\n                    });\n                    if (cargo.saturated && tasks.length === payload) {\n                        cargo.saturated();\n                    }\n                });\n                async.setImmediate(cargo.process);\n            },\n            process: function process() {\n                if (working) return;\n                if (tasks.length === 0) {\n                    if(cargo.drain) cargo.drain();\n                    return;\n                }\n\n                var ts = typeof payload === 'number'\n                            ? tasks.splice(0, payload)\n                            : tasks.splice(0);\n\n                var ds = _map(ts, function (task) {\n                    return task.data;\n                });\n\n                if(cargo.empty) cargo.empty();\n                working = true;\n                worker(ds, function () {\n                    working = false;\n\n                    var args = arguments;\n                    _each(ts, function (data) {\n                        if (data.callback) {\n                            data.callback.apply(null, args);\n                        }\n                    });\n\n                    process();\n                });\n            },\n            length: function () {\n                return tasks.length;\n            },\n            running: function () {\n                return working;\n            }\n        };\n        return cargo;\n    };\n\n    var _console_fn = function (name) {\n        return function (fn) {\n            var args = Array.prototype.slice.call(arguments, 1);\n            fn.apply(null, args.concat([function (err) {\n                var args = Array.prototype.slice.call(arguments, 1);\n                if (typeof console !== 'undefined') {\n                    if (err) {\n                        if (console.error) {\n                            console.error(err);\n                        }\n                    }\n                    else if (console[name]) {\n                        _each(args, function (x) {\n                            console[name](x);\n                        });\n                    }\n                }\n            }]));\n        };\n    };\n    async.log = _console_fn('log');\n    async.dir = _console_fn('dir');\n    /*async.info = _console_fn('info');\n    async.warn = _console_fn('warn');\n    async.error = _console_fn('error');*/\n\n    async.memoize = function (fn, hasher) {\n        var memo = {};\n        var queues = {};\n        hasher = hasher || function (x) {\n            return x;\n        };\n        var memoized = function () {\n            var args = Array.prototype.slice.call(arguments);\n            var callback = args.pop();\n            var key = hasher.apply(null, args);\n            if (key in memo) {\n                callback.apply(null, memo[key]);\n            }\n            else if (key in queues) {\n                queues[key].push(callback);\n            }\n            else {\n                queues[key] = [callback];\n                fn.apply(null, args.concat([function () {\n                    memo[key] = arguments;\n                    var q = queues[key];\n                    delete queues[key];\n                    for (var i = 0, l = q.length; i < l; i++) {\n                      q[i].apply(null, arguments);\n                    }\n                }]));\n            }\n        };\n        memoized.memo = memo;\n        memoized.unmemoized = fn;\n        return memoized;\n    };\n\n    async.unmemoize = function (fn) {\n      return function () {\n        return (fn.unmemoized || fn).apply(null, arguments);\n      };\n    };\n\n    async.times = function (count, iterator, callback) {\n        var counter = [];\n        for (var i = 0; i < count; i++) {\n            counter.push(i);\n        }\n        return async.map(counter, iterator, callback);\n    };\n\n    async.timesSeries = function (count, iterator, callback) {\n        var counter = [];\n        for (var i = 0; i < count; i++) {\n            counter.push(i);\n        }\n        return async.mapSeries(counter, iterator, callback);\n    };\n\n    async.compose = function (/* functions... */) {\n        var fns = Array.prototype.reverse.call(arguments);\n        return function () {\n            var that = this;\n            var args = Array.prototype.slice.call(arguments);\n            var callback = args.pop();\n            async.reduce(fns, args, function (newargs, fn, cb) {\n                fn.apply(that, newargs.concat([function () {\n                    var err = arguments[0];\n                    var nextargs = Array.prototype.slice.call(arguments, 1);\n                    cb(err, nextargs);\n                }]))\n            },\n            function (err, results) {\n                callback.apply(that, [err].concat(results));\n            });\n        };\n    };\n\n    var _applyEach = function (eachfn, fns /*args...*/) {\n        var go = function () {\n            var that = this;\n            var args = Array.prototype.slice.call(arguments);\n            var callback = args.pop();\n            return eachfn(fns, function (fn, cb) {\n                fn.apply(that, args.concat([cb]));\n            },\n            callback);\n        };\n        if (arguments.length > 2) {\n            var args = Array.prototype.slice.call(arguments, 2);\n            return go.apply(this, args);\n        }\n        else {\n            return go;\n        }\n    };\n    async.applyEach = doParallel(_applyEach);\n    async.applyEachSeries = doSeries(_applyEach);\n\n    async.forever = function (fn, callback) {\n        function next(err) {\n            if (err) {\n                if (callback) {\n                    return callback(err);\n                }\n                throw err;\n            }\n            fn(next);\n        }\n        next();\n    };\n\n    // AMD / RequireJS\n    if (typeof define !== 'undefined' && define.amd) {\n        define([], function () {\n            return async;\n        });\n    }\n    // Node.js\n    else if (typeof module !== 'undefined' && module.exports) {\n        module.exports = async;\n    }\n    // included directly via <script> tag\n    else {\n        root.async = async;\n    }\n\n}());\n","module.exports.BinarySearchTree = require('./lib/bst');\nmodule.exports.AVLTree = require('./lib/avltree');\n","/**\n * Self-balancing binary search tree using the AVL implementation\n */\nvar BinarySearchTree = require('./bst')\n  , customUtils = require('./customUtils')\n  , util = require('util')\n  , _ = require('underscore')\n  ;\n\n\n/**\n * Constructor\n * We can't use a direct pointer to the root node (as in the simple binary search tree)\n * as the root will change during tree rotations\n * @param {Boolean}  options.unique Whether to enforce a 'unique' constraint on the key or not\n * @param {Function} options.compareKeys Initialize this BST's compareKeys\n */\nfunction AVLTree (options) {\n  this.tree = new _AVLTree(options);\n}\n\n\n/**\n * Constructor of the internal AVLTree\n * @param {Object} options Optional\n * @param {Boolean}  options.unique Whether to enforce a 'unique' constraint on the key or not\n * @param {Key}      options.key Initialize this BST's key with key\n * @param {Value}    options.value Initialize this BST's data with [value]\n * @param {Function} options.compareKeys Initialize this BST's compareKeys\n */\nfunction _AVLTree (options) {\n  options = options || {};\n\n  this.left = null;\n  this.right = null;\n  this.parent = options.parent !== undefined ? options.parent : null;\n  if (options.hasOwnProperty('key')) { this.key = options.key; }\n  this.data = options.hasOwnProperty('value') ? [options.value] : [];\n  this.unique = options.unique || false;\n\n  this.compareKeys = options.compareKeys || customUtils.defaultCompareKeysFunction;\n  this.checkValueEquality = options.checkValueEquality || customUtils.defaultCheckValueEquality;\n}\n\n\n/**\n * Inherit basic functions from the basic binary search tree\n */\nutil.inherits(_AVLTree, BinarySearchTree);\n\n/**\n * Keep a pointer to the internal tree constructor for testing purposes\n */\nAVLTree._AVLTree = _AVLTree;\n\n\n/**\n * Check the recorded height is correct for every node\n * Throws if one height doesn't match\n */\n_AVLTree.prototype.checkHeightCorrect = function () {\n  var leftH, rightH;\n\n  if (!this.hasOwnProperty('key')) { return; }   // Empty tree\n\n  if (this.left && this.left.height === undefined) { throw new Error(\"Undefined height for node \" + this.left.key); }\n  if (this.right && this.right.height === undefined) { throw new Error(\"Undefined height for node \" + this.right.key); }\n  if (this.height === undefined) { throw new Error(\"Undefined height for node \" + this.key); }\n\n  leftH = this.left ? this.left.height : 0;\n  rightH = this.right ? this.right.height : 0;\n\n  if (this.height !== 1 + Math.max(leftH, rightH)) { throw new Error(\"Height constraint failed for node \" + this.key); }\n  if (this.left) { this.left.checkHeightCorrect(); }\n  if (this.right) { this.right.checkHeightCorrect(); }\n};\n\n\n/**\n * Return the balance factor\n */\n_AVLTree.prototype.balanceFactor = function () {\n  var leftH = this.left ? this.left.height : 0\n    , rightH = this.right ? this.right.height : 0\n    ;\n  return leftH - rightH;\n};\n\n\n/**\n * Check that the balance factors are all between -1 and 1\n */\n_AVLTree.prototype.checkBalanceFactors = function () {\n  if (Math.abs(this.balanceFactor()) > 1) { throw new Error('Tree is unbalanced at node ' + this.key); }\n\n  if (this.left) { this.left.checkBalanceFactors(); }\n  if (this.right) { this.right.checkBalanceFactors(); }\n};\n\n\n/**\n * When checking if the BST conditions are met, also check that the heights are correct\n * and the tree is balanced\n */\n_AVLTree.prototype.checkIsAVLT = function () {\n  _AVLTree.super_.prototype.checkIsBST.call(this);\n  this.checkHeightCorrect();\n  this.checkBalanceFactors();\n};\nAVLTree.prototype.checkIsAVLT = function () { this.tree.checkIsAVLT(); };\n\n\n/**\n * Perform a right rotation of the tree if possible\n * and return the root of the resulting tree\n * The resulting tree's nodes' heights are also updated\n */\n_AVLTree.prototype.rightRotation = function () {\n  var q = this\n    , p = this.left\n    , b\n    , ah, bh, ch;\n\n  if (!p) { return this; }   // No change\n\n  b = p.right;\n\n  // Alter tree structure\n  if (q.parent) {\n    p.parent = q.parent;\n    if (q.parent.left === q) { q.parent.left = p; } else { q.parent.right = p; }\n  } else {\n    p.parent = null;\n  }\n  p.right = q;\n  q.parent = p;\n  q.left = b;\n  if (b) { b.parent = q; }\n\n  // Update heights\n  ah = p.left ? p.left.height : 0;\n  bh = b ? b.height : 0;\n  ch = q.right ? q.right.height : 0;\n  q.height = Math.max(bh, ch) + 1;\n  p.height = Math.max(ah, q.height) + 1;\n\n  return p;\n};\n\n\n/**\n * Perform a left rotation of the tree if possible\n * and return the root of the resulting tree\n * The resulting tree's nodes' heights are also updated\n */\n_AVLTree.prototype.leftRotation = function () {\n  var p = this\n    , q = this.right\n    , b\n    , ah, bh, ch;\n\n  if (!q) { return this; }   // No change\n\n  b = q.left;\n\n  // Alter tree structure\n  if (p.parent) {\n    q.parent = p.parent;\n    if (p.parent.left === p) { p.parent.left = q; } else { p.parent.right = q; }\n  } else {\n    q.parent = null;\n  }\n  q.left = p;\n  p.parent = q;\n  p.right = b;\n  if (b) { b.parent = p; }\n\n  // Update heights\n  ah = p.left ? p.left.height : 0;\n  bh = b ? b.height : 0;\n  ch = q.right ? q.right.height : 0;\n  p.height = Math.max(ah, bh) + 1;\n  q.height = Math.max(ch, p.height) + 1;\n\n  return q;\n};\n\n\n/**\n * Modify the tree if its right subtree is too small compared to the left\n * Return the new root if any\n */\n_AVLTree.prototype.rightTooSmall = function () {\n  if (this.balanceFactor() <= 1) { return this; }   // Right is not too small, don't change\n\n  if (this.left.balanceFactor() < 0) {\n    this.left.leftRotation();\n  }\n\n  return this.rightRotation();\n};\n\n\n/**\n * Modify the tree if its left subtree is too small compared to the right\n * Return the new root if any\n */\n_AVLTree.prototype.leftTooSmall = function () {\n  if (this.balanceFactor() >= -1) { return this; }   // Left is not too small, don't change\n\n  if (this.right.balanceFactor() > 0) {\n    this.right.rightRotation();\n  }\n\n  return this.leftRotation();\n};\n\n\n/**\n * Rebalance the tree along the given path. The path is given reversed (as he was calculated\n * in the insert and delete functions).\n * Returns the new root of the tree\n * Of course, the first element of the path must be the root of the tree\n */\n_AVLTree.prototype.rebalanceAlongPath = function (path) {\n  var newRoot = this\n    , rotated\n    , i;\n\n  if (!this.hasOwnProperty('key')) { delete this.height; return this; }   // Empty tree\n\n  // Rebalance the tree and update all heights\n  for (i = path.length - 1; i >= 0; i -= 1) {\n    path[i].height = 1 + Math.max(path[i].left ? path[i].left.height : 0, path[i].right ? path[i].right.height : 0);\n\n    if (path[i].balanceFactor() > 1) {\n      rotated = path[i].rightTooSmall();\n      if (i === 0) { newRoot = rotated; }\n    }\n\n    if (path[i].balanceFactor() < -1) {\n      rotated = path[i].leftTooSmall();\n      if (i === 0) { newRoot = rotated; }\n    }\n  }\n\n  return newRoot;\n};\n\n\n/**\n * Insert a key, value pair in the tree while maintaining the AVL tree height constraint\n * Return a pointer to the root node, which may have changed\n */\n_AVLTree.prototype.insert = function (key, value) {\n  var insertPath = []\n    , currentNode = this\n    ;\n\n  // Empty tree, insert as root\n  if (!this.hasOwnProperty('key')) {\n    this.key = key;\n    this.data.push(value);\n    this.height = 1;\n    return this;\n  }\n\n  // Insert new leaf at the right place\n  while (true) {\n    // Same key: no change in the tree structure\n    if (currentNode.compareKeys(currentNode.key, key) === 0) {\n      if (currentNode.unique) {\n        var err = new Error(\"Can't insert key \" + key + \", it violates the unique constraint\");\n        err.key = key;\n        err.errorType = 'uniqueViolated';\n        throw err;\n      } else {\n        currentNode.data.push(value);\n      }\n      return this;\n    }\n\n    insertPath.push(currentNode);\n\n    if (currentNode.compareKeys(key, currentNode.key) < 0) {\n      if (!currentNode.left) {\n        insertPath.push(currentNode.createLeftChild({ key: key, value: value }));\n        break;\n      } else {\n        currentNode = currentNode.left;\n      }\n    } else {\n      if (!currentNode.right) {\n        insertPath.push(currentNode.createRightChild({ key: key, value: value }));\n        break;\n      } else {\n        currentNode = currentNode.right;\n      }\n    }\n  }\n\n  return this.rebalanceAlongPath(insertPath);\n};\n\n// Insert in the internal tree, update the pointer to the root if needed\nAVLTree.prototype.insert = function (key, value) {\n  var newTree = this.tree.insert(key, value);\n\n  // If newTree is undefined, that means its structure was not modified\n  if (newTree) { this.tree = newTree; }\n};\n\n\n/**\n * Delete a key or just a value and return the new root of the tree\n * @param {Key} key\n * @param {Value} value Optional. If not set, the whole key is deleted. If set, only this value is deleted\n */\n_AVLTree.prototype.delete = function (key, value) {\n  var newData = [], replaceWith\n    , self = this\n    , currentNode = this\n    , deletePath = []\n    ;\n\n  if (!this.hasOwnProperty('key')) { return this; }   // Empty tree\n\n  // Either no match is found and the function will return from within the loop\n  // Or a match is found and deletePath will contain the path from the root to the node to delete after the loop\n  while (true) {\n    if (currentNode.compareKeys(key, currentNode.key) === 0) { break; }\n\n    deletePath.push(currentNode);\n\n    if (currentNode.compareKeys(key, currentNode.key) < 0) {\n      if (currentNode.left) {\n        currentNode = currentNode.left;\n      } else {\n        return this;   // Key not found, no modification\n      }\n    } else {\n      // currentNode.compareKeys(key, currentNode.key) is > 0\n      if (currentNode.right) {\n        currentNode = currentNode.right;\n      } else {\n        return this;   // Key not found, no modification\n      }\n    }\n  }\n\n  // Delete only a value (no tree modification)\n  if (currentNode.data.length > 1 && value) {\n    currentNode.data.forEach(function (d) {\n      if (!currentNode.checkValueEquality(d, value)) { newData.push(d); }\n    });\n    currentNode.data = newData;\n    return this;\n  }\n\n  // Delete a whole node\n\n  // Leaf\n  if (!currentNode.left && !currentNode.right) {\n    if (currentNode === this) {   // This leaf is also the root\n      delete currentNode.key;\n      currentNode.data = [];\n      delete currentNode.height;\n      return this;\n    } else {\n      if (currentNode.parent.left === currentNode) {\n        currentNode.parent.left = null;\n      } else {\n        currentNode.parent.right = null;\n      }\n      return this.rebalanceAlongPath(deletePath);\n    }\n  }\n\n\n  // Node with only one child\n  if (!currentNode.left || !currentNode.right) {\n    replaceWith = currentNode.left ? currentNode.left : currentNode.right;\n\n    if (currentNode === this) {   // This node is also the root\n      replaceWith.parent = null;\n      return replaceWith;   // height of replaceWith is necessarily 1 because the tree was balanced before deletion\n    } else {\n      if (currentNode.parent.left === currentNode) {\n        currentNode.parent.left = replaceWith;\n        replaceWith.parent = currentNode.parent;\n      } else {\n        currentNode.parent.right = replaceWith;\n        replaceWith.parent = currentNode.parent;\n      }\n\n      return this.rebalanceAlongPath(deletePath);\n    }\n  }\n\n\n  // Node with two children\n  // Use the in-order predecessor (no need to randomize since we actively rebalance)\n  deletePath.push(currentNode);\n  replaceWith = currentNode.left;\n\n  // Special case: the in-order predecessor is right below the node to delete\n  if (!replaceWith.right) {\n    currentNode.key = replaceWith.key;\n    currentNode.data = replaceWith.data;\n    currentNode.left = replaceWith.left;\n    if (replaceWith.left) { replaceWith.left.parent = currentNode; }\n    return this.rebalanceAlongPath(deletePath);\n  }\n\n  // After this loop, replaceWith is the right-most leaf in the left subtree\n  // and deletePath the path from the root (inclusive) to replaceWith (exclusive)\n  while (true) {\n    if (replaceWith.right) {\n      deletePath.push(replaceWith);\n      replaceWith = replaceWith.right;\n    } else {\n      break;\n    }\n  }\n\n  currentNode.key = replaceWith.key;\n  currentNode.data = replaceWith.data;\n\n  replaceWith.parent.right = replaceWith.left;\n  if (replaceWith.left) { replaceWith.left.parent = replaceWith.parent; }\n\n  return this.rebalanceAlongPath(deletePath);\n};\n\n// Delete a value\nAVLTree.prototype.delete = function (key, value) {\n  var newTree = this.tree.delete(key, value);\n\n  // If newTree is undefined, that means its structure was not modified\n  if (newTree) { this.tree = newTree; }\n};\n\n\n/**\n * Other functions we want to use on an AVLTree as if it were the internal _AVLTree\n */\n['getNumberOfKeys', 'search', 'betweenBounds', 'prettyPrint', 'executeOnEveryNode'].forEach(function (fn) {\n  AVLTree.prototype[fn] = function () {\n    return this.tree[fn].apply(this.tree, arguments);\n  };\n});\n\n\n// Interface\nmodule.exports = AVLTree;\n","/**\n * Simple binary search tree\n */\nvar customUtils = require('./customUtils');\n\n\n/**\n * Constructor\n * @param {Object} options Optional\n * @param {Boolean}  options.unique Whether to enforce a 'unique' constraint on the key or not\n * @param {Key}      options.key Initialize this BST's key with key\n * @param {Value}    options.value Initialize this BST's data with [value]\n * @param {Function} options.compareKeys Initialize this BST's compareKeys\n */\nfunction BinarySearchTree (options) {\n  options = options || {};\n\n  this.left = null;\n  this.right = null;\n  this.parent = options.parent !== undefined ? options.parent : null;\n  if (options.hasOwnProperty('key')) { this.key = options.key; }\n  this.data = options.hasOwnProperty('value') ? [options.value] : [];\n  this.unique = options.unique || false;\n\n  this.compareKeys = options.compareKeys || customUtils.defaultCompareKeysFunction;\n  this.checkValueEquality = options.checkValueEquality || customUtils.defaultCheckValueEquality;\n}\n\n\n// ================================\n// Methods used to test the tree\n// ================================\n\n\n/**\n * Get the descendant with max key\n */\nBinarySearchTree.prototype.getMaxKeyDescendant = function () {\n  if (this.right) {\n    return this.right.getMaxKeyDescendant();\n  } else {\n    return this;\n  }\n};\n\n\n/**\n * Get the maximum key\n */\nBinarySearchTree.prototype.getMaxKey = function () {\n  return this.getMaxKeyDescendant().key;\n};\n\n\n/**\n * Get the descendant with min key\n */\nBinarySearchTree.prototype.getMinKeyDescendant = function () {\n  if (this.left) {\n    return this.left.getMinKeyDescendant()\n  } else {\n    return this;\n  }\n};\n\n\n/**\n * Get the minimum key\n */\nBinarySearchTree.prototype.getMinKey = function () {\n  return this.getMinKeyDescendant().key;\n};\n\n\n/**\n * Check that all nodes (incl. leaves) fullfil condition given by fn\n * test is a function passed every (key, data) and which throws if the condition is not met\n */\nBinarySearchTree.prototype.checkAllNodesFullfillCondition = function (test) {\n  if (!this.hasOwnProperty('key')) { return; }\n\n  test(this.key, this.data);\n  if (this.left) { this.left.checkAllNodesFullfillCondition(test); }\n  if (this.right) { this.right.checkAllNodesFullfillCondition(test); }\n};\n\n\n/**\n * Check that the core BST properties on node ordering are verified\n * Throw if they aren't\n */\nBinarySearchTree.prototype.checkNodeOrdering = function () {\n  var self = this;\n\n  if (!this.hasOwnProperty('key')) { return; }\n\n  if (this.left) {\n    this.left.checkAllNodesFullfillCondition(function (k) {\n      if (self.compareKeys(k, self.key) >= 0) {\n        throw new Error('Tree with root ' + self.key + ' is not a binary search tree');\n      }\n    });\n    this.left.checkNodeOrdering();\n  }\n\n  if (this.right) {\n    this.right.checkAllNodesFullfillCondition(function (k) {\n      if (self.compareKeys(k, self.key) <= 0) {\n        throw new Error('Tree with root ' + self.key + ' is not a binary search tree');\n      }\n    });\n    this.right.checkNodeOrdering();\n  }\n};\n\n\n/**\n * Check that all pointers are coherent in this tree\n */\nBinarySearchTree.prototype.checkInternalPointers = function () {\n  if (this.left) {\n    if (this.left.parent !== this) { throw new Error('Parent pointer broken for key ' + this.key); }\n    this.left.checkInternalPointers();\n  }\n\n  if (this.right) {\n    if (this.right.parent !== this) { throw new Error('Parent pointer broken for key ' + this.key); }\n    this.right.checkInternalPointers();\n  }\n};\n\n\n/**\n * Check that a tree is a BST as defined here (node ordering and pointer references)\n */\nBinarySearchTree.prototype.checkIsBST = function () {\n  this.checkNodeOrdering();\n  this.checkInternalPointers();\n  if (this.parent) { throw new Error(\"The root shouldn't have a parent\"); }\n};\n\n\n/**\n * Get number of keys inserted\n */\nBinarySearchTree.prototype.getNumberOfKeys = function () {\n  var res;\n\n  if (!this.hasOwnProperty('key')) { return 0; }\n\n  res = 1;\n  if (this.left) { res += this.left.getNumberOfKeys(); }\n  if (this.right) { res += this.right.getNumberOfKeys(); }\n\n  return res;\n};\n\n\n\n// ============================================\n// Methods used to actually work on the tree\n// ============================================\n\n/**\n * Create a BST similar (i.e. same options except for key and value) to the current one\n * Use the same constructor (i.e. BinarySearchTree, AVLTree etc)\n * @param {Object} options see constructor\n */\nBinarySearchTree.prototype.createSimilar = function (options) {\n  options = options || {};\n  options.unique = this.unique;\n  options.compareKeys = this.compareKeys;\n  options.checkValueEquality = this.checkValueEquality;\n\n  return new this.constructor(options);\n};\n\n\n/**\n * Create the left child of this BST and return it\n */\nBinarySearchTree.prototype.createLeftChild = function (options) {\n  var leftChild = this.createSimilar(options);\n  leftChild.parent = this;\n  this.left = leftChild;\n\n  return leftChild;\n};\n\n\n/**\n * Create the right child of this BST and return it\n */\nBinarySearchTree.prototype.createRightChild = function (options) {\n  var rightChild = this.createSimilar(options);\n  rightChild.parent = this;\n  this.right = rightChild;\n\n  return rightChild;\n};\n\n\n/**\n * Insert a new element\n */\nBinarySearchTree.prototype.insert = function (key, value) {\n  // Empty tree, insert as root\n  if (!this.hasOwnProperty('key')) {\n    this.key = key;\n    this.data.push(value);\n    return;\n  }\n\n  // Same key as root\n  if (this.compareKeys(this.key, key) === 0) {\n    if (this.unique) {\n      var err = new Error(\"Can't insert key \" + key + \", it violates the unique constraint\");\n      err.key = key;\n      err.errorType = 'uniqueViolated';\n      throw err;\n    } else {\n      this.data.push(value);\n    }\n    return;\n  }\n\n  if (this.compareKeys(key, this.key) < 0) {\n    // Insert in left subtree\n    if (this.left) {\n      this.left.insert(key, value);\n    } else {\n      this.createLeftChild({ key: key, value: value });\n    }\n  } else {\n    // Insert in right subtree\n    if (this.right) {\n      this.right.insert(key, value);\n    } else {\n      this.createRightChild({ key: key, value: value });\n    }\n  }\n};\n\n\n/**\n * Search for all data corresponding to a key\n */\nBinarySearchTree.prototype.search = function (key) {\n  if (!this.hasOwnProperty('key')) { return []; }\n\n  if (this.compareKeys(this.key, key) === 0) { return this.data; }\n\n  if (this.compareKeys(key, this.key) < 0) {\n    if (this.left) {\n      return this.left.search(key);\n    } else {\n      return [];\n    }\n  } else {\n    if (this.right) {\n      return this.right.search(key);\n    } else {\n      return [];\n    }\n  }\n};\n\n\n/**\n * Return a function that tells whether a given key matches a lower bound\n */\nBinarySearchTree.prototype.getLowerBoundMatcher = function (query) {\n  var self = this;\n\n  // No lower bound\n  if (!query.hasOwnProperty('$gt') && !query.hasOwnProperty('$gte')) {\n    return function () { return true; };\n  }\n\n  if (query.hasOwnProperty('$gt') && query.hasOwnProperty('$gte')) {\n    if (self.compareKeys(query.$gte, query.$gt) === 0) {\n      return function (key) { return self.compareKeys(key, query.$gt) > 0; };\n    }\n\n    if (self.compareKeys(query.$gte, query.$gt) > 0) {\n      return function (key) { return self.compareKeys(key, query.$gte) >= 0; };\n    } else {\n      return function (key) { return self.compareKeys(key, query.$gt) > 0; };\n    }\n  }\n\n  if (query.hasOwnProperty('$gt')) {\n    return function (key) { return self.compareKeys(key, query.$gt) > 0; };\n  } else {\n    return function (key) { return self.compareKeys(key, query.$gte) >= 0; };\n  }\n};\n\n\n/**\n * Return a function that tells whether a given key matches an upper bound\n */\nBinarySearchTree.prototype.getUpperBoundMatcher = function (query) {\n  var self = this;\n\n  // No lower bound\n  if (!query.hasOwnProperty('$lt') && !query.hasOwnProperty('$lte')) {\n    return function () { return true; };\n  }\n\n  if (query.hasOwnProperty('$lt') && query.hasOwnProperty('$lte')) {\n    if (self.compareKeys(query.$lte, query.$lt) === 0) {\n      return function (key) { return self.compareKeys(key, query.$lt) < 0; };\n    }\n\n    if (self.compareKeys(query.$lte, query.$lt) < 0) {\n      return function (key) { return self.compareKeys(key, query.$lte) <= 0; };\n    } else {\n      return function (key) { return self.compareKeys(key, query.$lt) < 0; };\n    }\n  }\n\n  if (query.hasOwnProperty('$lt')) {\n    return function (key) { return self.compareKeys(key, query.$lt) < 0; };\n  } else {\n    return function (key) { return self.compareKeys(key, query.$lte) <= 0; };\n  }\n};\n\n\n// Append all elements in toAppend to array\nfunction append (array, toAppend) {\n  var i;\n\n  for (i = 0; i < toAppend.length; i += 1) {\n    array.push(toAppend[i]);\n  }\n}\n\n\n/**\n * Get all data for a key between bounds\n * Return it in key order\n * @param {Object} query Mongo-style query where keys are $lt, $lte, $gt or $gte (other keys are not considered)\n * @param {Functions} lbm/ubm matching functions calculated at the first recursive step\n */\nBinarySearchTree.prototype.betweenBounds = function (query, lbm, ubm) {\n  var res = [];\n\n  if (!this.hasOwnProperty('key')) { return []; }   // Empty tree\n\n  lbm = lbm || this.getLowerBoundMatcher(query);\n  ubm = ubm || this.getUpperBoundMatcher(query);\n\n  if (lbm(this.key) && this.left) { append(res, this.left.betweenBounds(query, lbm, ubm)); }\n  if (lbm(this.key) && ubm(this.key)) { append(res, this.data); }\n  if (ubm(this.key) && this.right) { append(res, this.right.betweenBounds(query, lbm, ubm)); }\n\n  return res;\n};\n\n\n/**\n * Delete the current node if it is a leaf\n * Return true if it was deleted\n */\nBinarySearchTree.prototype.deleteIfLeaf = function () {\n  if (this.left || this.right) { return false; }\n\n  // The leaf is itself a root\n  if (!this.parent) {\n    delete this.key;\n    this.data = [];\n    return true;\n  }\n\n  if (this.parent.left === this) {\n    this.parent.left = null;\n  } else {\n    this.parent.right = null;\n  }\n\n  return true;\n};\n\n\n/**\n * Delete the current node if it has only one child\n * Return true if it was deleted\n */\nBinarySearchTree.prototype.deleteIfOnlyOneChild = function () {\n  var child;\n\n  if (this.left && !this.right) { child = this.left; }\n  if (!this.left && this.right) { child = this.right; }\n  if (!child) { return false; }\n\n  // Root\n  if (!this.parent) {\n    this.key = child.key;\n    this.data = child.data;\n\n    this.left = null;\n    if (child.left) {\n      this.left = child.left;\n      child.left.parent = this;\n    }\n\n    this.right = null;\n    if (child.right) {\n      this.right = child.right;\n      child.right.parent = this;\n    }\n\n    return true;\n  }\n\n  if (this.parent.left === this) {\n    this.parent.left = child;\n    child.parent = this.parent;\n  } else {\n    this.parent.right = child;\n    child.parent = this.parent;\n  }\n\n  return true;\n};\n\n\n/**\n * Delete a key or just a value\n * @param {Key} key\n * @param {Value} value Optional. If not set, the whole key is deleted. If set, only this value is deleted\n */\nBinarySearchTree.prototype.delete = function (key, value) {\n  var newData = [], replaceWith\n    , self = this\n    ;\n\n  if (!this.hasOwnProperty('key')) { return; }\n\n  if (this.compareKeys(key, this.key) < 0) {\n    if (this.left) { this.left.delete(key, value); }\n    return;\n  }\n\n  if (this.compareKeys(key, this.key) > 0) {\n    if (this.right) { this.right.delete(key, value); }\n    return;\n  }\n\n  if (!this.compareKeys(key, this.key) === 0) { return; }\n\n  // Delete only a value\n  if (this.data.length > 1 && value !== undefined) {\n    this.data.forEach(function (d) {\n      if (!self.checkValueEquality(d, value)) { newData.push(d); }\n    });\n    self.data = newData;\n    return;\n  }\n\n  // Delete the whole node\n  if (this.deleteIfLeaf()) {\n    return;\n  }\n  if (this.deleteIfOnlyOneChild()) {\n    return;\n  }\n\n  // We are in the case where the node to delete has two children\n  if (Math.random() >= 0.5) {   // Randomize replacement to avoid unbalancing the tree too much\n    // Use the in-order predecessor\n    replaceWith = this.left.getMaxKeyDescendant();\n\n    this.key = replaceWith.key;\n    this.data = replaceWith.data;\n\n    if (this === replaceWith.parent) {   // Special case\n      this.left = replaceWith.left;\n      if (replaceWith.left) { replaceWith.left.parent = replaceWith.parent; }\n    } else {\n      replaceWith.parent.right = replaceWith.left;\n      if (replaceWith.left) { replaceWith.left.parent = replaceWith.parent; }\n    }\n  } else {\n    // Use the in-order successor\n    replaceWith = this.right.getMinKeyDescendant();\n\n    this.key = replaceWith.key;\n    this.data = replaceWith.data;\n\n    if (this === replaceWith.parent) {   // Special case\n      this.right = replaceWith.right;\n      if (replaceWith.right) { replaceWith.right.parent = replaceWith.parent; }\n    } else {\n      replaceWith.parent.left = replaceWith.right;\n      if (replaceWith.right) { replaceWith.right.parent = replaceWith.parent; }\n    }\n  }\n};\n\n\n/**\n * Execute a function on every node of the tree, in key order\n * @param {Function} fn Signature: node. Most useful will probably be node.key and node.data\n */\nBinarySearchTree.prototype.executeOnEveryNode = function (fn) {\n  if (this.left) { this.left.executeOnEveryNode(fn); }\n  fn(this);\n  if (this.right) { this.right.executeOnEveryNode(fn); }\n};\n\n\n/**\n * Pretty print a tree\n * @param {Boolean} printData To print the nodes' data along with the key\n */\nBinarySearchTree.prototype.prettyPrint = function (printData, spacing) {\n  spacing = spacing || \"\";\n\n  console.log(spacing + \"* \" + this.key);\n  if (printData) { console.log(spacing + \"* \" + this.data); }\n\n  if (!this.left && !this.right) { return; }\n\n  if (this.left) {\n    this.left.prettyPrint(printData, spacing + \"  \");\n  } else {\n    console.log(spacing + \"  *\");\n  }\n  if (this.right) {\n    this.right.prettyPrint(printData, spacing + \"  \");\n  } else {\n    console.log(spacing + \"  *\");\n  }\n};\n\n\n\n\n// Interface\nmodule.exports = BinarySearchTree;\n","/**\n * Return an array with the numbers from 0 to n-1, in a random order\n */\nfunction getRandomArray (n) {\n  var res, next;\n\n  if (n === 0) { return []; }\n  if (n === 1) { return [0]; }\n\n  res = getRandomArray(n - 1);\n  next = Math.floor(Math.random() * n);\n  res.splice(next, 0, n - 1);   // Add n-1 at a random position in the array\n\n  return res;\n};\nmodule.exports.getRandomArray = getRandomArray;\n\n\n/*\n * Default compareKeys function will work for numbers, strings and dates\n */\nfunction defaultCompareKeysFunction (a, b) {\n  if (a < b) { return -1; }\n  if (a > b) { return 1; }\n  if (a === b) { return 0; }\n\n  var err = new Error(\"Couldn't compare elements\");\n  err.a = a;\n  err.b = b;\n  throw err;\n}\nmodule.exports.defaultCompareKeysFunction = defaultCompareKeysFunction;\n\n\n/**\n * Check whether two values are equal (used in non-unique deletion)\n */\nfunction defaultCheckValueEquality (a, b) {\n  return a === b;\n}\nmodule.exports.defaultCheckValueEquality = defaultCheckValueEquality;\n","var path = require('path');\nvar fs = require('fs');\nvar _0777 = parseInt('0777', 8);\n\nmodule.exports = mkdirP.mkdirp = mkdirP.mkdirP = mkdirP;\n\nfunction mkdirP (p, opts, f, made) {\n    if (typeof opts === 'function') {\n        f = opts;\n        opts = {};\n    }\n    else if (!opts || typeof opts !== 'object') {\n        opts = { mode: opts };\n    }\n    \n    var mode = opts.mode;\n    var xfs = opts.fs || fs;\n    \n    if (mode === undefined) {\n        mode = _0777\n    }\n    if (!made) made = null;\n    \n    var cb = f || function () {};\n    p = path.resolve(p);\n    \n    xfs.mkdir(p, mode, function (er) {\n        if (!er) {\n            made = made || p;\n            return cb(null, made);\n        }\n        switch (er.code) {\n            case 'ENOENT':\n                if (path.dirname(p) === p) return cb(er);\n                mkdirP(path.dirname(p), opts, function (er, made) {\n                    if (er) cb(er, made);\n                    else mkdirP(p, opts, cb, made);\n                });\n                break;\n\n            // In the case of any other error, just see if there's a dir\n            // there already.  If so, then hooray!  If not, then something\n            // is borked.\n            default:\n                xfs.stat(p, function (er2, stat) {\n                    // if the stat fails, then that's super weird.\n                    // let the original error be the failure reason.\n                    if (er2 || !stat.isDirectory()) cb(er, made)\n                    else cb(null, made);\n                });\n                break;\n        }\n    });\n}\n\nmkdirP.sync = function sync (p, opts, made) {\n    if (!opts || typeof opts !== 'object') {\n        opts = { mode: opts };\n    }\n    \n    var mode = opts.mode;\n    var xfs = opts.fs || fs;\n    \n    if (mode === undefined) {\n        mode = _0777\n    }\n    if (!made) made = null;\n\n    p = path.resolve(p);\n\n    try {\n        xfs.mkdirSync(p, mode);\n        made = made || p;\n    }\n    catch (err0) {\n        switch (err0.code) {\n            case 'ENOENT' :\n                made = sync(path.dirname(p), opts, made);\n                sync(p, opts, made);\n                break;\n\n            // In the case of any other error, just see if there's a dir\n            // there already.  If so, then hooray!  If not, then something\n            // is borked.\n            default:\n                var stat;\n                try {\n                    stat = xfs.statSync(p);\n                }\n                catch (err1) {\n                    throw err0;\n                }\n                if (!stat.isDirectory()) throw err0;\n                break;\n        }\n    }\n\n    return made;\n};\n","var Datastore = require('./lib/datastore');\n\nmodule.exports = Datastore;\n","/**\n * Manage access to data, be it to find, update or remove it\n */\nvar model = require('./model')\n  , _ = require('underscore')\n  ;\n\n\n\n/**\n * Create a new cursor for this collection\n * @param {Datastore} db - The datastore this cursor is bound to\n * @param {Query} query - The query this cursor will operate on\n * @param {Function} execFn - Handler to be executed after cursor has found the results and before the callback passed to find/findOne/update/remove\n */\nfunction Cursor (db, query, execFn) {\n  this.db = db;\n  this.query = query || {};\n  if (execFn) { this.execFn = execFn; }\n}\n\n\n/**\n * Set a limit to the number of results\n */\nCursor.prototype.limit = function(limit) {\n  this._limit = limit;\n  return this;\n};\n\n\n/**\n * Skip a the number of results\n */\nCursor.prototype.skip = function(skip) {\n  this._skip = skip;\n  return this;\n};\n\n\n/**\n * Sort results of the query\n * @param {SortQuery} sortQuery - SortQuery is { field: order }, field can use the dot-notation, order is 1 for ascending and -1 for descending\n */\nCursor.prototype.sort = function(sortQuery) {\n  this._sort = sortQuery;\n  return this;\n};\n\n\n/**\n * Add the use of a projection\n * @param {Object} projection - MongoDB-style projection. {} means take all fields. Then it's { key1: 1, key2: 1 } to take only key1 and key2\n *                              { key1: 0, key2: 0 } to omit only key1 and key2. Except _id, you can't mix takes and omits\n */\nCursor.prototype.projection = function(projection) {\n  this._projection = projection;\n  return this;\n};\n\n\n/**\n * Apply the projection\n */\nCursor.prototype.project = function (candidates) {\n  var res = [], self = this\n    , keepId, action, keys\n    ;\n\n  if (this._projection === undefined || Object.keys(this._projection).length === 0) {\n    return candidates;\n  }\n\n  keepId = this._projection._id === 0 ? false : true;\n  this._projection = _.omit(this._projection, '_id');\n\n  // Check for consistency\n  keys = Object.keys(this._projection);\n  keys.forEach(function (k) {\n    if (action !== undefined && self._projection[k] !== action) { throw new Error(\"Can't both keep and omit fields except for _id\"); }\n    action = self._projection[k];\n  });\n\n  // Do the actual projection\n  candidates.forEach(function (candidate) {\n    var toPush;\n    if (action === 1) {   // pick-type projection\n      toPush = { $set: {} };\n      keys.forEach(function (k) {\n        toPush.$set[k] = model.getDotValue(candidate, k);\n        if (toPush.$set[k] === undefined) { delete toPush.$set[k]; }\n      });\n      toPush = model.modify({}, toPush);\n    } else {   // omit-type projection\n      toPush = { $unset: {} };\n      keys.forEach(function (k) { toPush.$unset[k] = true });\n      toPush = model.modify(candidate, toPush);\n    }\n    if (keepId) {\n      toPush._id = candidate._id;\n    } else {\n      delete toPush._id;\n    }\n    res.push(toPush);\n  });\n\n  return res;\n};\n\n\n/**\n * Get all matching elements\n * Will return pointers to matched elements (shallow copies), returning full copies is the role of find or findOne\n * This is an internal function, use exec which uses the executor\n *\n * @param {Function} callback - Signature: err, results\n */\nCursor.prototype._exec = function(_callback) {\n  var res = [], added = 0, skipped = 0, self = this\n    , error = null\n    , i, keys, key\n    ;\n\n  function callback (error, res) {\n    if (self.execFn) {\n      return self.execFn(error, res, _callback);\n    } else {\n      return _callback(error, res);\n    }\n  }\n\n  this.db.getCandidates(this.query, function (err, candidates) {\n    if (err) { return callback(err); }\n\n    try {\n      for (i = 0; i < candidates.length; i += 1) {\n        if (model.match(candidates[i], self.query)) {\n          // If a sort is defined, wait for the results to be sorted before applying limit and skip\n          if (!self._sort) {\n            if (self._skip && self._skip > skipped) {\n              skipped += 1;\n            } else {\n              res.push(candidates[i]);\n              added += 1;\n              if (self._limit && self._limit <= added) { break; }\n            }\n          } else {\n            res.push(candidates[i]);\n          }\n        }\n      }\n    } catch (err) {\n      return callback(err);\n    }\n\n    // Apply all sorts\n    if (self._sort) {\n      keys = Object.keys(self._sort);\n\n      // Sorting\n      var criteria = [];\n      for (i = 0; i < keys.length; i++) {\n        key = keys[i];\n        criteria.push({ key: key, direction: self._sort[key] });\n      }\n      res.sort(function(a, b) {\n        var criterion, compare, i;\n        for (i = 0; i < criteria.length; i++) {\n          criterion = criteria[i];\n          compare = criterion.direction * model.compareThings(model.getDotValue(a, criterion.key), model.getDotValue(b, criterion.key), self.db.compareStrings);\n          if (compare !== 0) {\n            return compare;\n          }\n        }\n        return 0;\n      });\n\n      // Applying limit and skip\n      var limit = self._limit || res.length\n        , skip = self._skip || 0;\n\n      res = res.slice(skip, skip + limit);\n    }\n\n    // Apply projection\n    try {\n      res = self.project(res);\n    } catch (e) {\n      error = e;\n      res = undefined;\n    }\n\n    return callback(error, res);\n  });\n};\n\nCursor.prototype.exec = function () {\n  this.db.executor.push({ this: this, fn: this._exec, arguments: arguments });\n};\n\n\n\n// Interface\nmodule.exports = Cursor;\n","var crypto = require('crypto')\n  ;\n\n/**\n * Return a random alphanumerical string of length len\n * There is a very small probability (less than 1/1,000,000) for the length to be less than len\n * (il the base64 conversion yields too many pluses and slashes) but\n * that's not an issue here\n * The probability of a collision is extremely small (need 3*10^12 documents to have one chance in a million of a collision)\n * See http://en.wikipedia.org/wiki/Birthday_problem\n */\nfunction uid (len) {\n  return crypto.randomBytes(Math.ceil(Math.max(8, len * 2)))\n    .toString('base64')\n    .replace(/[+\\/]/g, '')\n    .slice(0, len);\n}\n\n\n// Interface\nmodule.exports.uid = uid;\n\n","var customUtils = require('./customUtils')\n  , model = require('./model')\n  , async = require('async')\n  , Executor = require('./executor')\n  , Index = require('./indexes')\n  , util = require('util')\n  , _ = require('underscore')\n  , Persistence = require('./persistence')\n  , Cursor = require('./cursor')\n  ;\n\n\n/**\n * Create a new collection\n * @param {String} options.filename Optional, datastore will be in-memory only if not provided\n * @param {Boolean} options.timestampData Optional, defaults to false. If set to true, createdAt and updatedAt will be created and populated automatically (if not specified by user)\n * @param {Boolean} options.inMemoryOnly Optional, defaults to false\n * @param {String} options.nodeWebkitAppName Optional, specify the name of your NW app if you want options.filename to be relative to the directory where\n *                                            Node Webkit stores application data such as cookies and local storage (the best place to store data in my opinion)\n * @param {Boolean} options.autoload Optional, defaults to false\n * @param {Function} options.onload Optional, if autoload is used this will be called after the load database with the error object as parameter. If you don't pass it the error will be thrown\n * @param {Function} options.afterSerialization/options.beforeDeserialization Optional, serialization hooks\n * @param {Number} options.corruptAlertThreshold Optional, threshold after which an alert is thrown if too much data is corrupt\n * @param {Function} options.compareStrings Optional, string comparison function that overrides default for sorting\n *\n * Event Emitter - Events\n * * compaction.done - Fired whenever a compaction operation was finished\n */\nfunction Datastore (options) {\n  var filename;\n\n  // Retrocompatibility with v0.6 and before\n  if (typeof options === 'string') {\n    filename = options;\n    this.inMemoryOnly = false;   // Default\n  } else {\n    options = options || {};\n    filename = options.filename;\n    this.inMemoryOnly = options.inMemoryOnly || false;\n    this.autoload = options.autoload || false;\n    this.timestampData = options.timestampData || false;\n  }\n\n  // Determine whether in memory or persistent\n  if (!filename || typeof filename !== 'string' || filename.length === 0) {\n    this.filename = null;\n    this.inMemoryOnly = true;\n  } else {\n    this.filename = filename;\n  }\n\n  // String comparison function\n  this.compareStrings = options.compareStrings;\n\n  // Persistence handling\n  this.persistence = new Persistence({ db: this, nodeWebkitAppName: options.nodeWebkitAppName\n                                      , afterSerialization: options.afterSerialization\n                                      , beforeDeserialization: options.beforeDeserialization\n                                      , corruptAlertThreshold: options.corruptAlertThreshold\n                                      });\n\n  // This new executor is ready if we don't use persistence\n  // If we do, it will only be ready once loadDatabase is called\n  this.executor = new Executor();\n  if (this.inMemoryOnly) { this.executor.ready = true; }\n\n  // Indexed by field name, dot notation can be used\n  // _id is always indexed and since _ids are generated randomly the underlying\n  // binary is always well-balanced\n  this.indexes = {};\n  this.indexes._id = new Index({ fieldName: '_id', unique: true });\n  this.ttlIndexes = {};\n\n  // Queue a load of the database right away and call the onload handler\n  // By default (no onload handler), if there is an error there, no operation will be possible so warn the user by throwing an exception\n  if (this.autoload) { this.loadDatabase(options.onload || function (err) {\n    if (err) { throw err; }\n  }); }\n}\n\nutil.inherits(Datastore, require('events').EventEmitter);\n\n\n/**\n * Load the database from the datafile, and trigger the execution of buffered commands if any\n */\nDatastore.prototype.loadDatabase = function () {\n  this.executor.push({ this: this.persistence, fn: this.persistence.loadDatabase, arguments: arguments }, true);\n};\n\n\n/**\n * Get an array of all the data in the database\n */\nDatastore.prototype.getAllData = function () {\n  return this.indexes._id.getAll();\n};\n\n\n/**\n * Reset all currently defined indexes\n */\nDatastore.prototype.resetIndexes = function (newData) {\n  var self = this;\n\n  Object.keys(this.indexes).forEach(function (i) {\n    self.indexes[i].reset(newData);\n  });\n};\n\n\n/**\n * Ensure an index is kept for this field. Same parameters as lib/indexes\n * For now this function is synchronous, we need to test how much time it takes\n * We use an async API for consistency with the rest of the code\n * @param {String} options.fieldName\n * @param {Boolean} options.unique\n * @param {Boolean} options.sparse\n * @param {Number} options.expireAfterSeconds - Optional, if set this index becomes a TTL index (only works on Date fields, not arrays of Date)\n * @param {Function} cb Optional callback, signature: err\n */\nDatastore.prototype.ensureIndex = function (options, cb) {\n  var err\n    , callback = cb || function () {};\n\n  options = options || {};\n\n  if (!options.fieldName) {\n    err = new Error(\"Cannot create an index without a fieldName\");\n    err.missingFieldName = true;\n    return callback(err);\n  }\n  if (this.indexes[options.fieldName]) { return callback(null); }\n\n  this.indexes[options.fieldName] = new Index(options);\n  if (options.expireAfterSeconds !== undefined) { this.ttlIndexes[options.fieldName] = options.expireAfterSeconds; }   // With this implementation index creation is not necessary to ensure TTL but we stick with MongoDB's API here\n\n  try {\n    this.indexes[options.fieldName].insert(this.getAllData());\n  } catch (e) {\n    delete this.indexes[options.fieldName];\n    return callback(e);\n  }\n\n  // We may want to force all options to be persisted including defaults, not just the ones passed the index creation function\n  this.persistence.persistNewState([{ $$indexCreated: options }], function (err) {\n    if (err) { return callback(err); }\n    return callback(null);\n  });\n};\n\n\n/**\n * Remove an index\n * @param {String} fieldName\n * @param {Function} cb Optional callback, signature: err\n */\nDatastore.prototype.removeIndex = function (fieldName, cb) {\n  var callback = cb || function () {};\n\n  delete this.indexes[fieldName];\n\n  this.persistence.persistNewState([{ $$indexRemoved: fieldName }], function (err) {\n    if (err) { return callback(err); }\n    return callback(null);\n  });\n};\n\n\n/**\n * Add one or several document(s) to all indexes\n */\nDatastore.prototype.addToIndexes = function (doc) {\n  var i, failingIndex, error\n    , keys = Object.keys(this.indexes)\n    ;\n\n  for (i = 0; i < keys.length; i += 1) {\n    try {\n      this.indexes[keys[i]].insert(doc);\n    } catch (e) {\n      failingIndex = i;\n      error = e;\n      break;\n    }\n  }\n\n  // If an error happened, we need to rollback the insert on all other indexes\n  if (error) {\n    for (i = 0; i < failingIndex; i += 1) {\n      this.indexes[keys[i]].remove(doc);\n    }\n\n    throw error;\n  }\n};\n\n\n/**\n * Remove one or several document(s) from all indexes\n */\nDatastore.prototype.removeFromIndexes = function (doc) {\n  var self = this;\n\n  Object.keys(this.indexes).forEach(function (i) {\n    self.indexes[i].remove(doc);\n  });\n};\n\n\n/**\n * Update one or several documents in all indexes\n * To update multiple documents, oldDoc must be an array of { oldDoc, newDoc } pairs\n * If one update violates a constraint, all changes are rolled back\n */\nDatastore.prototype.updateIndexes = function (oldDoc, newDoc) {\n  var i, failingIndex, error\n    , keys = Object.keys(this.indexes)\n    ;\n\n  for (i = 0; i < keys.length; i += 1) {\n    try {\n      this.indexes[keys[i]].update(oldDoc, newDoc);\n    } catch (e) {\n      failingIndex = i;\n      error = e;\n      break;\n    }\n  }\n\n  // If an error happened, we need to rollback the update on all other indexes\n  if (error) {\n    for (i = 0; i < failingIndex; i += 1) {\n      this.indexes[keys[i]].revertUpdate(oldDoc, newDoc);\n    }\n\n    throw error;\n  }\n};\n\n\n/**\n * Return the list of candidates for a given query\n * Crude implementation for now, we return the candidates given by the first usable index if any\n * We try the following query types, in this order: basic match, $in match, comparison match\n * One way to make it better would be to enable the use of multiple indexes if the first usable index\n * returns too much data. I may do it in the future.\n *\n * Returned candidates will be scanned to find and remove all expired documents\n *\n * @param {Query} query\n * @param {Boolean} dontExpireStaleDocs Optional, defaults to false, if true don't remove stale docs. Useful for the remove function which shouldn't be impacted by expirations\n * @param {Function} callback Signature err, docs\n */\nDatastore.prototype.getCandidates = function (query, dontExpireStaleDocs, callback) {\n  var indexNames = Object.keys(this.indexes)\n    , self = this\n    , usableQueryKeys;\n\n  if (typeof dontExpireStaleDocs === 'function') {\n    callback = dontExpireStaleDocs;\n    dontExpireStaleDocs = false;\n  }\n\n  async.waterfall([\n  // STEP 1: get candidates list by checking indexes from most to least frequent usecase\n  function (cb) {\n    // For a basic match\n    usableQueryKeys = [];\n    Object.keys(query).forEach(function (k) {\n      if (typeof query[k] === 'string' || typeof query[k] === 'number' || typeof query[k] === 'boolean' || util.isDate(query[k]) || query[k] === null) {\n        usableQueryKeys.push(k);\n      }\n    });\n    usableQueryKeys = _.intersection(usableQueryKeys, indexNames);\n    if (usableQueryKeys.length > 0) {\n      return cb(null, self.indexes[usableQueryKeys[0]].getMatching(query[usableQueryKeys[0]]));\n    }\n\n    // For a $in match\n    usableQueryKeys = [];\n    Object.keys(query).forEach(function (k) {\n      if (query[k] && query[k].hasOwnProperty('$in')) {\n        usableQueryKeys.push(k);\n      }\n    });\n    usableQueryKeys = _.intersection(usableQueryKeys, indexNames);\n    if (usableQueryKeys.length > 0) {\n      return cb(null, self.indexes[usableQueryKeys[0]].getMatching(query[usableQueryKeys[0]].$in));\n    }\n\n    // For a comparison match\n    usableQueryKeys = [];\n    Object.keys(query).forEach(function (k) {\n      if (query[k] && (query[k].hasOwnProperty('$lt') || query[k].hasOwnProperty('$lte') || query[k].hasOwnProperty('$gt') || query[k].hasOwnProperty('$gte'))) {\n        usableQueryKeys.push(k);\n      }\n    });\n    usableQueryKeys = _.intersection(usableQueryKeys, indexNames);\n    if (usableQueryKeys.length > 0) {\n      return cb(null, self.indexes[usableQueryKeys[0]].getBetweenBounds(query[usableQueryKeys[0]]));\n    }\n\n    // By default, return all the DB data\n    return cb(null, self.getAllData());\n  }\n  // STEP 2: remove all expired documents\n  , function (docs) {\n    if (dontExpireStaleDocs) { return callback(null, docs); }\n\n    var expiredDocsIds = [], validDocs = [], ttlIndexesFieldNames = Object.keys(self.ttlIndexes);\n\n    docs.forEach(function (doc) {\n      var valid = true;\n      ttlIndexesFieldNames.forEach(function (i) {\n        if (doc[i] !== undefined && util.isDate(doc[i]) && Date.now() > doc[i].getTime() + self.ttlIndexes[i] * 1000) {\n          valid = false;\n        }\n      });\n      if (valid) { validDocs.push(doc); } else { expiredDocsIds.push(doc._id); }\n    });\n\n    async.eachSeries(expiredDocsIds, function (_id, cb) {\n      self._remove({ _id: _id }, {}, function (err) {\n        if (err) { return callback(err); }\n        return cb();\n      });\n    }, function (err) {\n      return callback(null, validDocs);\n    });\n  }]);\n};\n\n\n/**\n * Insert a new document\n * @param {Function} cb Optional callback, signature: err, insertedDoc\n *\n * @api private Use Datastore.insert which has the same signature\n */\nDatastore.prototype._insert = function (newDoc, cb) {\n  var callback = cb || function () {}\n    , preparedDoc\n    ;\n\n  try {\n    preparedDoc = this.prepareDocumentForInsertion(newDoc)\n    this._insertInCache(preparedDoc);\n  } catch (e) {\n    return callback(e);\n  }\n\n  this.persistence.persistNewState(util.isArray(preparedDoc) ? preparedDoc : [preparedDoc], function (err) {\n    if (err) { return callback(err); }\n    return callback(null, model.deepCopy(preparedDoc));\n  });\n};\n\n/**\n * Create a new _id that's not already in use\n */\nDatastore.prototype.createNewId = function () {\n  var tentativeId = customUtils.uid(16);\n  // Try as many times as needed to get an unused _id. As explained in customUtils, the probability of this ever happening is extremely small, so this is O(1)\n  if (this.indexes._id.getMatching(tentativeId).length > 0) {\n    tentativeId = this.createNewId();\n  }\n  return tentativeId;\n};\n\n/**\n * Prepare a document (or array of documents) to be inserted in a database\n * Meaning adds _id and timestamps if necessary on a copy of newDoc to avoid any side effect on user input\n * @api private\n */\nDatastore.prototype.prepareDocumentForInsertion = function (newDoc) {\n  var preparedDoc, self = this;\n\n  if (util.isArray(newDoc)) {\n    preparedDoc = [];\n    newDoc.forEach(function (doc) { preparedDoc.push(self.prepareDocumentForInsertion(doc)); });\n  } else {\n    preparedDoc = model.deepCopy(newDoc);\n    if (preparedDoc._id === undefined) { preparedDoc._id = this.createNewId(); }\n    var now = new Date();\n    if (this.timestampData && preparedDoc.createdAt === undefined) { preparedDoc.createdAt = now; }\n    if (this.timestampData && preparedDoc.updatedAt === undefined) { preparedDoc.updatedAt = now; }\n    model.checkObject(preparedDoc);\n  }\n\n  return preparedDoc;\n};\n\n/**\n * If newDoc is an array of documents, this will insert all documents in the cache\n * @api private\n */\nDatastore.prototype._insertInCache = function (preparedDoc) {\n  if (util.isArray(preparedDoc)) {\n    this._insertMultipleDocsInCache(preparedDoc);\n  } else {\n    this.addToIndexes(preparedDoc);\n  }\n};\n\n/**\n * If one insertion fails (e.g. because of a unique constraint), roll back all previous\n * inserts and throws the error\n * @api private\n */\nDatastore.prototype._insertMultipleDocsInCache = function (preparedDocs) {\n  var i, failingI, error;\n\n  for (i = 0; i < preparedDocs.length; i += 1) {\n    try {\n      this.addToIndexes(preparedDocs[i]);\n    } catch (e) {\n      error = e;\n      failingI = i;\n      break;\n    }\n  }\n\n  if (error) {\n    for (i = 0; i < failingI; i += 1) {\n      this.removeFromIndexes(preparedDocs[i]);\n    }\n\n    throw error;\n  }\n};\n\nDatastore.prototype.insert = function () {\n  this.executor.push({ this: this, fn: this._insert, arguments: arguments });\n};\n\n\n/**\n * Count all documents matching the query\n * @param {Object} query MongoDB-style query\n */\nDatastore.prototype.count = function(query, callback) {\n  var cursor = new Cursor(this, query, function(err, docs, callback) {\n    if (err) { return callback(err); }\n    return callback(null, docs.length);\n  });\n\n  if (typeof callback === 'function') {\n    cursor.exec(callback);\n  } else {\n    return cursor;\n  }\n};\n\n\n/**\n * Find all documents matching the query\n * If no callback is passed, we return the cursor so that user can limit, skip and finally exec\n * @param {Object} query MongoDB-style query\n * @param {Object} projection MongoDB-style projection\n */\nDatastore.prototype.find = function (query, projection, callback) {\n  switch (arguments.length) {\n    case 1:\n      projection = {};\n      // callback is undefined, will return a cursor\n      break;\n    case 2:\n      if (typeof projection === 'function') {\n        callback = projection;\n        projection = {};\n      }   // If not assume projection is an object and callback undefined\n      break;\n  }\n\n  var cursor = new Cursor(this, query, function(err, docs, callback) {\n    var res = [], i;\n\n    if (err) { return callback(err); }\n\n    for (i = 0; i < docs.length; i += 1) {\n      res.push(model.deepCopy(docs[i]));\n    }\n    return callback(null, res);\n  });\n\n  cursor.projection(projection);\n  if (typeof callback === 'function') {\n    cursor.exec(callback);\n  } else {\n    return cursor;\n  }\n};\n\n\n/**\n * Find one document matching the query\n * @param {Object} query MongoDB-style query\n * @param {Object} projection MongoDB-style projection\n */\nDatastore.prototype.findOne = function (query, projection, callback) {\n  switch (arguments.length) {\n    case 1:\n      projection = {};\n      // callback is undefined, will return a cursor\n      break;\n    case 2:\n      if (typeof projection === 'function') {\n        callback = projection;\n        projection = {};\n      }   // If not assume projection is an object and callback undefined\n      break;\n  }\n\n  var cursor = new Cursor(this, query, function(err, docs, callback) {\n    if (err) { return callback(err); }\n    if (docs.length === 1) {\n      return callback(null, model.deepCopy(docs[0]));\n    } else {\n      return callback(null, null);\n    }\n  });\n\n  cursor.projection(projection).limit(1);\n  if (typeof callback === 'function') {\n    cursor.exec(callback);\n  } else {\n    return cursor;\n  }\n};\n\n\n/**\n * Update all docs matching query\n * @param {Object} query\n * @param {Object} updateQuery\n * @param {Object} options Optional options\n *                 options.multi If true, can update multiple documents (defaults to false)\n *                 options.upsert If true, document is inserted if the query doesn't match anything\n *                 options.returnUpdatedDocs Defaults to false, if true return as third argument the array of updated matched documents (even if no change actually took place)\n * @param {Function} cb Optional callback, signature: (err, numAffected, affectedDocuments, upsert)\n *                      If update was an upsert, upsert flag is set to true\n *                      affectedDocuments can be one of the following:\n *                        * For an upsert, the upserted document\n *                        * For an update with returnUpdatedDocs option false, null\n *                        * For an update with returnUpdatedDocs true and multi false, the updated document\n *                        * For an update with returnUpdatedDocs true and multi true, the array of updated documents\n *\n * WARNING: The API was changed between v1.7.4 and v1.8, for consistency and readability reasons. Prior and including to v1.7.4,\n *          the callback signature was (err, numAffected, updated) where updated was the updated document in case of an upsert\n *          or the array of updated documents for an update if the returnUpdatedDocs option was true. That meant that the type of\n *          affectedDocuments in a non multi update depended on whether there was an upsert or not, leaving only two ways for the\n *          user to check whether an upsert had occured: checking the type of affectedDocuments or running another find query on\n *          the whole dataset to check its size. Both options being ugly, the breaking change was necessary.\n *\n * @api private Use Datastore.update which has the same signature\n */\nDatastore.prototype._update = function (query, updateQuery, options, cb) {\n  var callback\n    , self = this\n    , numReplaced = 0\n    , multi, upsert\n    , i\n    ;\n\n  if (typeof options === 'function') { cb = options; options = {}; }\n  callback = cb || function () {};\n  multi = options.multi !== undefined ? options.multi : false;\n  upsert = options.upsert !== undefined ? options.upsert : false;\n\n  async.waterfall([\n  function (cb) {   // If upsert option is set, check whether we need to insert the doc\n    if (!upsert) { return cb(); }\n\n    // Need to use an internal function not tied to the executor to avoid deadlock\n    var cursor = new Cursor(self, query);\n    cursor.limit(1)._exec(function (err, docs) {\n      if (err) { return callback(err); }\n      if (docs.length === 1) {\n        return cb();\n      } else {\n        var toBeInserted;\n\n        try {\n          model.checkObject(updateQuery);\n          // updateQuery is a simple object with no modifier, use it as the document to insert\n          toBeInserted = updateQuery;\n        } catch (e) {\n          // updateQuery contains modifiers, use the find query as the base,\n          // strip it from all operators and update it according to updateQuery\n          try {\n            toBeInserted = model.modify(model.deepCopy(query, true), updateQuery);\n          } catch (err) {\n            return callback(err);\n          }\n        }\n\n        return self._insert(toBeInserted, function (err, newDoc) {\n          if (err) { return callback(err); }\n          return callback(null, 1, newDoc, true);\n        });\n      }\n    });\n  }\n  , function () {   // Perform the update\n    var modifiedDoc , modifications = [], createdAt;\n\n    self.getCandidates(query, function (err, candidates) {\n      if (err) { return callback(err); }\n\n      // Preparing update (if an error is thrown here neither the datafile nor\n      // the in-memory indexes are affected)\n      try {\n        for (i = 0; i < candidates.length; i += 1) {\n          if (model.match(candidates[i], query) && (multi || numReplaced === 0)) {\n            numReplaced += 1;\n            if (self.timestampData) { createdAt = candidates[i].createdAt; }\n            modifiedDoc = model.modify(candidates[i], updateQuery);\n            if (self.timestampData) {\n              modifiedDoc.createdAt = createdAt;\n              modifiedDoc.updatedAt = new Date();\n            }\n            modifications.push({ oldDoc: candidates[i], newDoc: modifiedDoc });\n          }\n        }\n      } catch (err) {\n        return callback(err);\n      }\n\n      // Change the docs in memory\n      try {\n        self.updateIndexes(modifications);\n      } catch (err) {\n        return callback(err);\n      }\n\n      // Update the datafile\n      var updatedDocs = _.pluck(modifications, 'newDoc');\n      self.persistence.persistNewState(updatedDocs, function (err) {\n        if (err) { return callback(err); }\n        if (!options.returnUpdatedDocs) {\n          return callback(null, numReplaced);\n        } else {\n          var updatedDocsDC = [];\n          updatedDocs.forEach(function (doc) { updatedDocsDC.push(model.deepCopy(doc)); });\n          if (! multi) { updatedDocsDC = updatedDocsDC[0]; }\n          return callback(null, numReplaced, updatedDocsDC);\n        }\n      });\n    });\n  }]);\n};\n\nDatastore.prototype.update = function () {\n  this.executor.push({ this: this, fn: this._update, arguments: arguments });\n};\n\n\n/**\n * Remove all docs matching the query\n * For now very naive implementation (similar to update)\n * @param {Object} query\n * @param {Object} options Optional options\n *                 options.multi If true, can update multiple documents (defaults to false)\n * @param {Function} cb Optional callback, signature: err, numRemoved\n *\n * @api private Use Datastore.remove which has the same signature\n */\nDatastore.prototype._remove = function (query, options, cb) {\n  var callback\n    , self = this, numRemoved = 0, removedDocs = [], multi\n    ;\n\n  if (typeof options === 'function') { cb = options; options = {}; }\n  callback = cb || function () {};\n  multi = options.multi !== undefined ? options.multi : false;\n\n  this.getCandidates(query, true, function (err, candidates) {\n    if (err) { return callback(err); }\n\n    try {\n      candidates.forEach(function (d) {\n        if (model.match(d, query) && (multi || numRemoved === 0)) {\n          numRemoved += 1;\n          removedDocs.push({ $$deleted: true, _id: d._id });\n          self.removeFromIndexes(d);\n        }\n      });\n    } catch (err) { return callback(err); }\n\n    self.persistence.persistNewState(removedDocs, function (err) {\n      if (err) { return callback(err); }\n      return callback(null, numRemoved);\n    });\n  });\n};\n\nDatastore.prototype.remove = function () {\n  this.executor.push({ this: this, fn: this._remove, arguments: arguments });\n};\n\n\n\nmodule.exports = Datastore;\n","/**\n * Responsible for sequentially executing actions on the database\n */\n\nvar async = require('async')\n  ;\n\nfunction Executor () {\n  this.buffer = [];\n  this.ready = false;\n\n  // This queue will execute all commands, one-by-one in order\n  this.queue = async.queue(function (task, cb) {\n    var newArguments = [];\n\n    // task.arguments is an array-like object on which adding a new field doesn't work, so we transform it into a real array\n    for (var i = 0; i < task.arguments.length; i += 1) { newArguments.push(task.arguments[i]); }\n    var lastArg = task.arguments[task.arguments.length - 1];\n\n    // Always tell the queue task is complete. Execute callback if any was given.\n    if (typeof lastArg === 'function') {\n      // Callback was supplied\n      newArguments[newArguments.length - 1] = function () {\n        if (typeof setImmediate === 'function') {\n           setImmediate(cb);\n        } else {\n          process.nextTick(cb);\n        }\n        lastArg.apply(null, arguments);\n      };\n    } else if (!lastArg && task.arguments.length !== 0) {\n      // false/undefined/null supplied as callbback\n      newArguments[newArguments.length - 1] = function () { cb(); };\n    } else {\n      // Nothing supplied as callback\n      newArguments.push(function () { cb(); });\n    }\n\n\n    task.fn.apply(task.this, newArguments);\n  }, 1);\n}\n\n\n/**\n * If executor is ready, queue task (and process it immediately if executor was idle)\n * If not, buffer task for later processing\n * @param {Object} task\n *                 task.this - Object to use as this\n *                 task.fn - Function to execute\n *                 task.arguments - Array of arguments, IMPORTANT: only the last argument may be a function (the callback)\n *                                                                 and the last argument cannot be false/undefined/null\n * @param {Boolean} forceQueuing Optional (defaults to false) force executor to queue task even if it is not ready\n */\nExecutor.prototype.push = function (task, forceQueuing) {\n  if (this.ready || forceQueuing) {\n    this.queue.push(task);\n  } else {\n    this.buffer.push(task);\n  }\n};\n\n\n/**\n * Queue all tasks in buffer (in the same order they came in)\n * Automatically sets executor as ready\n */\nExecutor.prototype.processBuffer = function () {\n  var i;\n  this.ready = true;\n  for (i = 0; i < this.buffer.length; i += 1) { this.queue.push(this.buffer[i]); }\n  this.buffer = [];\n};\n\n\n\n// Interface\nmodule.exports = Executor;\n","var BinarySearchTree = require('binary-search-tree').AVLTree\n  , model = require('./model')\n  , _ = require('underscore')\n  , util = require('util')\n  ;\n\n/**\n * Two indexed pointers are equal iif they point to the same place\n */\nfunction checkValueEquality (a, b) {\n  return a === b;\n}\n\n/**\n * Type-aware projection\n */\nfunction projectForUnique (elt) {\n  if (elt === null) { return '$null'; }\n  if (typeof elt === 'string') { return '$string' + elt; }\n  if (typeof elt === 'boolean') { return '$boolean' + elt; }\n  if (typeof elt === 'number') { return '$number' + elt; }\n  if (util.isArray(elt)) { return '$date' + elt.getTime(); }\n\n  return elt;   // Arrays and objects, will check for pointer equality\n}\n\n\n/**\n * Create a new index\n * All methods on an index guarantee that either the whole operation was successful and the index changed\n * or the operation was unsuccessful and an error is thrown while the index is unchanged\n * @param {String} options.fieldName On which field should the index apply (can use dot notation to index on sub fields)\n * @param {Boolean} options.unique Optional, enforce a unique constraint (default: false)\n * @param {Boolean} options.sparse Optional, allow a sparse index (we can have documents for which fieldName is undefined) (default: false)\n */\nfunction Index (options) {\n  this.fieldName = options.fieldName;\n  this.unique = options.unique || false;\n  this.sparse = options.sparse || false;\n\n  this.treeOptions = { unique: this.unique, compareKeys: model.compareThings, checkValueEquality: checkValueEquality };\n\n  this.reset();   // No data in the beginning\n}\n\n\n/**\n * Reset an index\n * @param {Document or Array of documents} newData Optional, data to initialize the index with\n *                                                 If an error is thrown during insertion, the index is not modified\n */\nIndex.prototype.reset = function (newData) {\n  this.tree = new BinarySearchTree(this.treeOptions);\n\n  if (newData) { this.insert(newData); }\n};\n\n\n/**\n * Insert a new document in the index\n * If an array is passed, we insert all its elements (if one insertion fails the index is not modified)\n * O(log(n))\n */\nIndex.prototype.insert = function (doc) {\n  var key, self = this\n    , keys, i, failingI, error\n    ;\n\n  if (util.isArray(doc)) { this.insertMultipleDocs(doc); return; }\n\n  key = model.getDotValue(doc, this.fieldName);\n\n  // We don't index documents that don't contain the field if the index is sparse\n  if (key === undefined && this.sparse) { return; }\n\n  if (!util.isArray(key)) {\n    this.tree.insert(key, doc);\n  } else {\n    // If an insert fails due to a unique constraint, roll back all inserts before it\n    keys = _.uniq(key, projectForUnique);\n\n    for (i = 0; i < keys.length; i += 1) {\n      try {\n        this.tree.insert(keys[i], doc);\n      } catch (e) {\n        error = e;\n        failingI = i;\n        break;\n      }\n    }\n\n    if (error) {\n      for (i = 0; i < failingI; i += 1) {\n        this.tree.delete(keys[i], doc);\n      }\n\n      throw error;\n    }\n  }\n};\n\n\n/**\n * Insert an array of documents in the index\n * If a constraint is violated, the changes should be rolled back and an error thrown\n *\n * @API private\n */\nIndex.prototype.insertMultipleDocs = function (docs) {\n  var i, error, failingI;\n\n  for (i = 0; i < docs.length; i += 1) {\n    try {\n      this.insert(docs[i]);\n    } catch (e) {\n      error = e;\n      failingI = i;\n      break;\n    }\n  }\n\n  if (error) {\n    for (i = 0; i < failingI; i += 1) {\n      this.remove(docs[i]);\n    }\n\n    throw error;\n  }\n};\n\n\n/**\n * Remove a document from the index\n * If an array is passed, we remove all its elements\n * The remove operation is safe with regards to the 'unique' constraint\n * O(log(n))\n */\nIndex.prototype.remove = function (doc) {\n  var key, self = this;\n\n  if (util.isArray(doc)) { doc.forEach(function (d) { self.remove(d); }); return; }\n\n  key = model.getDotValue(doc, this.fieldName);\n\n  if (key === undefined && this.sparse) { return; }\n\n  if (!util.isArray(key)) {\n    this.tree.delete(key, doc);\n  } else {\n    _.uniq(key, projectForUnique).forEach(function (_key) {\n      self.tree.delete(_key, doc);\n    });\n  }\n};\n\n\n/**\n * Update a document in the index\n * If a constraint is violated, changes are rolled back and an error thrown\n * Naive implementation, still in O(log(n))\n */\nIndex.prototype.update = function (oldDoc, newDoc) {\n  if (util.isArray(oldDoc)) { this.updateMultipleDocs(oldDoc); return; }\n\n  this.remove(oldDoc);\n\n  try {\n    this.insert(newDoc);\n  } catch (e) {\n    this.insert(oldDoc);\n    throw e;\n  }\n};\n\n\n/**\n * Update multiple documents in the index\n * If a constraint is violated, the changes need to be rolled back\n * and an error thrown\n * @param {Array of oldDoc, newDoc pairs} pairs\n *\n * @API private\n */\nIndex.prototype.updateMultipleDocs = function (pairs) {\n  var i, failingI, error;\n\n  for (i = 0; i < pairs.length; i += 1) {\n    this.remove(pairs[i].oldDoc);\n  }\n\n  for (i = 0; i < pairs.length; i += 1) {\n    try {\n      this.insert(pairs[i].newDoc);\n    } catch (e) {\n      error = e;\n      failingI = i;\n      break;\n    }\n  }\n\n  // If an error was raised, roll back changes in the inverse order\n  if (error) {\n    for (i = 0; i < failingI; i += 1) {\n      this.remove(pairs[i].newDoc);\n    }\n\n    for (i = 0; i < pairs.length; i += 1) {\n      this.insert(pairs[i].oldDoc);\n    }\n\n    throw error;\n  }\n};\n\n\n/**\n * Revert an update\n */\nIndex.prototype.revertUpdate = function (oldDoc, newDoc) {\n  var revert = [];\n\n  if (!util.isArray(oldDoc)) {\n    this.update(newDoc, oldDoc);\n  } else {\n    oldDoc.forEach(function (pair) {\n      revert.push({ oldDoc: pair.newDoc, newDoc: pair.oldDoc });\n    });\n    this.update(revert);\n  }\n};\n\n\n/**\n * Get all documents in index whose key match value (if it is a Thing) or one of the elements of value (if it is an array of Things)\n * @param {Thing} value Value to match the key against\n * @return {Array of documents}\n */\nIndex.prototype.getMatching = function (value) {\n  var self = this;\n\n  if (!util.isArray(value)) {\n    return self.tree.search(value);\n  } else {\n    var _res = {}, res = [];\n\n    value.forEach(function (v) {\n      self.getMatching(v).forEach(function (doc) {\n        _res[doc._id] = doc;\n      });\n    });\n\n    Object.keys(_res).forEach(function (_id) {\n      res.push(_res[_id]);\n    });\n\n    return res;\n  }\n};\n\n\n/**\n * Get all documents in index whose key is between bounds are they are defined by query\n * Documents are sorted by key\n * @param {Query} query\n * @return {Array of documents}\n */\nIndex.prototype.getBetweenBounds = function (query) {\n  return this.tree.betweenBounds(query);\n};\n\n\n/**\n * Get all elements in the index\n * @return {Array of documents}\n */\nIndex.prototype.getAll = function () {\n  var res = [];\n\n  this.tree.executeOnEveryNode(function (node) {\n    var i;\n\n    for (i = 0; i < node.data.length; i += 1) {\n      res.push(node.data[i]);\n    }\n  });\n\n  return res;\n};\n\n\n\n\n// Interface\nmodule.exports = Index;\n","/**\n * Handle models (i.e. docs)\n * Serialization/deserialization\n * Copying\n * Querying, update\n */\n\nvar util = require('util')\n  , _ = require('underscore')\n  , modifierFunctions = {}\n  , lastStepModifierFunctions = {}\n  , comparisonFunctions = {}\n  , logicalOperators = {}\n  , arrayComparisonFunctions = {}\n  ;\n\n\n/**\n * Check a key, throw an error if the key is non valid\n * @param {String} k key\n * @param {Model} v value, needed to treat the Date edge case\n * Non-treatable edge cases here: if part of the object if of the form { $$date: number } or { $$deleted: true }\n * Its serialized-then-deserialized version it will transformed into a Date object\n * But you really need to want it to trigger such behaviour, even when warned not to use '$' at the beginning of the field names...\n */\nfunction checkKey (k, v) {\n  if (typeof k === 'number') {\n    k = k.toString();\n  }\n\n  if (k[0] === '$' && !(k === '$$date' && typeof v === 'number') && !(k === '$$deleted' && v === true) && !(k === '$$indexCreated') && !(k === '$$indexRemoved')) {\n    throw new Error('Field names cannot begin with the $ character');\n  }\n\n  if (k.indexOf('.') !== -1) {\n    throw new Error('Field names cannot contain a .');\n  }\n}\n\n\n/**\n * Check a DB object and throw an error if it's not valid\n * Works by applying the above checkKey function to all fields recursively\n */\nfunction checkObject (obj) {\n  if (util.isArray(obj)) {\n    obj.forEach(function (o) {\n      checkObject(o);\n    });\n  }\n\n  if (typeof obj === 'object' && obj !== null) {\n    Object.keys(obj).forEach(function (k) {\n      checkKey(k, obj[k]);\n      checkObject(obj[k]);\n    });\n  }\n}\n\n\n/**\n * Serialize an object to be persisted to a one-line string\n * For serialization/deserialization, we use the native JSON parser and not eval or Function\n * That gives us less freedom but data entered in the database may come from users\n * so eval and the like are not safe\n * Accepted primitive types: Number, String, Boolean, Date, null\n * Accepted secondary types: Objects, Arrays\n */\nfunction serialize (obj) {\n  var res;\n\n  res = JSON.stringify(obj, function (k, v) {\n    checkKey(k, v);\n\n    if (v === undefined) { return undefined; }\n    if (v === null) { return null; }\n\n    // Hackish way of checking if object is Date (this way it works between execution contexts in node-webkit).\n    // We can't use value directly because for dates it is already string in this function (date.toJSON was already called), so we use this\n    if (typeof this[k].getTime === 'function') { return { $$date: this[k].getTime() }; }\n\n    return v;\n  });\n\n  return res;\n}\n\n\n/**\n * From a one-line representation of an object generate by the serialize function\n * Return the object itself\n */\nfunction deserialize (rawData) {\n  return JSON.parse(rawData, function (k, v) {\n    if (k === '$$date') { return new Date(v); }\n    if (typeof v === 'string' || typeof v === 'number' || typeof v === 'boolean' || v === null) { return v; }\n    if (v && v.$$date) { return v.$$date; }\n\n    return v;\n  });\n}\n\n\n/**\n * Deep copy a DB object\n * The optional strictKeys flag (defaulting to false) indicates whether to copy everything or only fields\n * where the keys are valid, i.e. don't begin with $ and don't contain a .\n */\nfunction deepCopy (obj, strictKeys) {\n  var res;\n\n  if ( typeof obj === 'boolean' ||\n       typeof obj === 'number' ||\n       typeof obj === 'string' ||\n       obj === null ||\n       (util.isDate(obj)) ) {\n    return obj;\n  }\n\n  if (util.isArray(obj)) {\n    res = [];\n    obj.forEach(function (o) { res.push(deepCopy(o, strictKeys)); });\n    return res;\n  }\n\n  if (typeof obj === 'object') {\n    res = {};\n    Object.keys(obj).forEach(function (k) {\n      if (!strictKeys || (k[0] !== '$' && k.indexOf('.') === -1)) {\n        res[k] = deepCopy(obj[k], strictKeys);\n      }\n    });\n    return res;\n  }\n\n  return undefined;   // For now everything else is undefined. We should probably throw an error instead\n}\n\n\n/**\n * Tells if an object is a primitive type or a \"real\" object\n * Arrays are considered primitive\n */\nfunction isPrimitiveType (obj) {\n  return ( typeof obj === 'boolean' ||\n       typeof obj === 'number' ||\n       typeof obj === 'string' ||\n       obj === null ||\n       util.isDate(obj) ||\n       util.isArray(obj));\n}\n\n\n/**\n * Utility functions for comparing things\n * Assumes type checking was already done (a and b already have the same type)\n * compareNSB works for numbers, strings and booleans\n */\nfunction compareNSB (a, b) {\n  if (a < b) { return -1; }\n  if (a > b) { return 1; }\n  return 0;\n}\n\nfunction compareArrays (a, b) {\n  var i, comp;\n\n  for (i = 0; i < Math.min(a.length, b.length); i += 1) {\n    comp = compareThings(a[i], b[i]);\n\n    if (comp !== 0) { return comp; }\n  }\n\n  // Common section was identical, longest one wins\n  return compareNSB(a.length, b.length);\n}\n\n\n/**\n * Compare { things U undefined }\n * Things are defined as any native types (string, number, boolean, null, date) and objects\n * We need to compare with undefined as it will be used in indexes\n * In the case of objects and arrays, we deep-compare\n * If two objects dont have the same type, the (arbitrary) type hierarchy is: undefined, null, number, strings, boolean, dates, arrays, objects\n * Return -1 if a < b, 1 if a > b and 0 if a = b (note that equality here is NOT the same as defined in areThingsEqual!)\n *\n * @param {Function} _compareStrings String comparing function, returning -1, 0 or 1, overriding default string comparison (useful for languages with accented letters)\n */\nfunction compareThings (a, b, _compareStrings) {\n  var aKeys, bKeys, comp, i\n    , compareStrings = _compareStrings || compareNSB;\n\n  // undefined\n  if (a === undefined) { return b === undefined ? 0 : -1; }\n  if (b === undefined) { return a === undefined ? 0 : 1; }\n\n  // null\n  if (a === null) { return b === null ? 0 : -1; }\n  if (b === null) { return a === null ? 0 : 1; }\n\n  // Numbers\n  if (typeof a === 'number') { return typeof b === 'number' ? compareNSB(a, b) : -1; }\n  if (typeof b === 'number') { return typeof a === 'number' ? compareNSB(a, b) : 1; }\n\n  // Strings\n  if (typeof a === 'string') { return typeof b === 'string' ? compareStrings(a, b) : -1; }\n  if (typeof b === 'string') { return typeof a === 'string' ? compareStrings(a, b) : 1; }\n\n  // Booleans\n  if (typeof a === 'boolean') { return typeof b === 'boolean' ? compareNSB(a, b) : -1; }\n  if (typeof b === 'boolean') { return typeof a === 'boolean' ? compareNSB(a, b) : 1; }\n\n  // Dates\n  if (util.isDate(a)) { return util.isDate(b) ? compareNSB(a.getTime(), b.getTime()) : -1; }\n  if (util.isDate(b)) { return util.isDate(a) ? compareNSB(a.getTime(), b.getTime()) : 1; }\n\n  // Arrays (first element is most significant and so on)\n  if (util.isArray(a)) { return util.isArray(b) ? compareArrays(a, b) : -1; }\n  if (util.isArray(b)) { return util.isArray(a) ? compareArrays(a, b) : 1; }\n\n  // Objects\n  aKeys = Object.keys(a).sort();\n  bKeys = Object.keys(b).sort();\n\n  for (i = 0; i < Math.min(aKeys.length, bKeys.length); i += 1) {\n    comp = compareThings(a[aKeys[i]], b[bKeys[i]]);\n\n    if (comp !== 0) { return comp; }\n  }\n\n  return compareNSB(aKeys.length, bKeys.length);\n}\n\n\n\n// ==============================================================\n// Updating documents\n// ==============================================================\n\n/**\n * The signature of modifier functions is as follows\n * Their structure is always the same: recursively follow the dot notation while creating\n * the nested documents if needed, then apply the \"last step modifier\"\n * @param {Object} obj The model to modify\n * @param {String} field Can contain dots, in that case that means we will set a subfield recursively\n * @param {Model} value\n */\n\n/**\n * Set a field to a new value\n */\nlastStepModifierFunctions.$set = function (obj, field, value) {\n  obj[field] = value;\n};\n\n\n/**\n * Unset a field\n */\nlastStepModifierFunctions.$unset = function (obj, field, value) {\n  delete obj[field];\n};\n\n\n/**\n * Push an element to the end of an array field\n * Optional modifier $each instead of value to push several values\n * Optional modifier $slice to slice the resulting array, see https://docs.mongodb.org/manual/reference/operator/update/slice/\n * Différeence with MongoDB: if $slice is specified and not $each, we act as if value is an empty array\n */\nlastStepModifierFunctions.$push = function (obj, field, value) {\n  // Create the array if it doesn't exist\n  if (!obj.hasOwnProperty(field)) { obj[field] = []; }\n\n  if (!util.isArray(obj[field])) { throw new Error(\"Can't $push an element on non-array values\"); }\n\n  if (value !== null && typeof value === 'object' && value.$slice && value.$each === undefined) {\n    value.$each = [];\n  }\n\n  if (value !== null && typeof value === 'object' && value.$each) {\n    if (Object.keys(value).length >= 3 || (Object.keys(value).length === 2 && value.$slice === undefined)) { throw new Error(\"Can only use $slice in cunjunction with $each when $push to array\"); }\n    if (!util.isArray(value.$each)) { throw new Error(\"$each requires an array value\"); }\n\n    value.$each.forEach(function (v) {\n      obj[field].push(v);\n    });\n\n    if (value.$slice === undefined || typeof value.$slice !== 'number') { return; }\n\n    if (value.$slice === 0) {\n      obj[field] = [];\n    } else {\n      var start, end, n = obj[field].length;\n      if (value.$slice < 0) {\n        start = Math.max(0, n + value.$slice);\n        end = n;\n      } else if (value.$slice > 0) {\n        start = 0;\n        end = Math.min(n, value.$slice);\n      }\n      obj[field] = obj[field].slice(start, end);\n    }\n  } else {\n    obj[field].push(value);\n  }\n};\n\n\n/**\n * Add an element to an array field only if it is not already in it\n * No modification if the element is already in the array\n * Note that it doesn't check whether the original array contains duplicates\n */\nlastStepModifierFunctions.$addToSet = function (obj, field, value) {\n  var addToSet = true;\n\n  // Create the array if it doesn't exist\n  if (!obj.hasOwnProperty(field)) { obj[field] = []; }\n\n  if (!util.isArray(obj[field])) { throw new Error(\"Can't $addToSet an element on non-array values\"); }\n\n  if (value !== null && typeof value === 'object' && value.$each) {\n    if (Object.keys(value).length > 1) { throw new Error(\"Can't use another field in conjunction with $each\"); }\n    if (!util.isArray(value.$each)) { throw new Error(\"$each requires an array value\"); }\n\n    value.$each.forEach(function (v) {\n      lastStepModifierFunctions.$addToSet(obj, field, v);\n    });\n  } else {\n    obj[field].forEach(function (v) {\n      if (compareThings(v, value) === 0) { addToSet = false; }\n    });\n    if (addToSet) { obj[field].push(value); }\n  }\n};\n\n\n/**\n * Remove the first or last element of an array\n */\nlastStepModifierFunctions.$pop = function (obj, field, value) {\n  if (!util.isArray(obj[field])) { throw new Error(\"Can't $pop an element from non-array values\"); }\n  if (typeof value !== 'number') { throw new Error(value + \" isn't an integer, can't use it with $pop\"); }\n  if (value === 0) { return; }\n\n  if (value > 0) {\n    obj[field] = obj[field].slice(0, obj[field].length - 1);\n  } else {\n    obj[field] = obj[field].slice(1);\n  }\n};\n\n\n/**\n * Removes all instances of a value from an existing array\n */\nlastStepModifierFunctions.$pull = function (obj, field, value) {\n  var arr, i;\n\n  if (!util.isArray(obj[field])) { throw new Error(\"Can't $pull an element from non-array values\"); }\n\n  arr = obj[field];\n  for (i = arr.length - 1; i >= 0; i -= 1) {\n    if (match(arr[i], value)) {\n      arr.splice(i, 1);\n    }\n  }\n};\n\n\n/**\n * Increment a numeric field's value\n */\nlastStepModifierFunctions.$inc = function (obj, field, value) {\n  if (typeof value !== 'number') { throw new Error(value + \" must be a number\"); }\n\n  if (typeof obj[field] !== 'number') {\n    if (!_.has(obj, field)) {\n      obj[field] = value;\n    } else {\n      throw new Error(\"Don't use the $inc modifier on non-number fields\");\n    }\n  } else {\n    obj[field] += value;\n  }\n};\n\n/**\n * Updates the value of the field, only if specified field is greater than the current value of the field\n */\nlastStepModifierFunctions.$max = function (obj, field, value) {\n  if (typeof obj[field] === 'undefined') {\n    obj[field] = value;\n  } else if (value > obj[field]) {\n    obj[field] = value;\n  }\n};\n\n/**\n * Updates the value of the field, only if specified field is smaller than the current value of the field\n */\nlastStepModifierFunctions.$min = function (obj, field, value) {\n  if (typeof obj[field] === 'undefined') { \n    obj[field] = value;\n  } else if (value < obj[field]) {\n    obj[field] = value;\n  }\n};\n\n// Given its name, create the complete modifier function\nfunction createModifierFunction (modifier) {\n  return function (obj, field, value) {\n    var fieldParts = typeof field === 'string' ? field.split('.') : field;\n\n    if (fieldParts.length === 1) {\n      lastStepModifierFunctions[modifier](obj, field, value);\n    } else {\n      if (obj[fieldParts[0]] === undefined) {\n        if (modifier === '$unset') { return; }   // Bad looking specific fix, needs to be generalized modifiers that behave like $unset are implemented\n        obj[fieldParts[0]] = {};\n      }\n      modifierFunctions[modifier](obj[fieldParts[0]], fieldParts.slice(1), value);\n    }\n  };\n}\n\n// Actually create all modifier functions\nObject.keys(lastStepModifierFunctions).forEach(function (modifier) {\n  modifierFunctions[modifier] = createModifierFunction(modifier);\n});\n\n\n/**\n * Modify a DB object according to an update query\n */\nfunction modify (obj, updateQuery) {\n  var keys = Object.keys(updateQuery)\n    , firstChars = _.map(keys, function (item) { return item[0]; })\n    , dollarFirstChars = _.filter(firstChars, function (c) { return c === '$'; })\n    , newDoc, modifiers\n    ;\n\n  if (keys.indexOf('_id') !== -1 && updateQuery._id !== obj._id) { throw new Error(\"You cannot change a document's _id\"); }\n\n  if (dollarFirstChars.length !== 0 && dollarFirstChars.length !== firstChars.length) {\n    throw new Error(\"You cannot mix modifiers and normal fields\");\n  }\n\n  if (dollarFirstChars.length === 0) {\n    // Simply replace the object with the update query contents\n    newDoc = deepCopy(updateQuery);\n    newDoc._id = obj._id;\n  } else {\n    // Apply modifiers\n    modifiers = _.uniq(keys);\n    newDoc = deepCopy(obj);\n    modifiers.forEach(function (m) {\n      var keys;\n\n      if (!modifierFunctions[m]) { throw new Error(\"Unknown modifier \" + m); }\n\n      // Can't rely on Object.keys throwing on non objects since ES6\n      // Not 100% satisfying as non objects can be interpreted as objects but no false negatives so we can live with it\n      if (typeof updateQuery[m] !== 'object') {\n        throw new Error(\"Modifier \" + m + \"'s argument must be an object\");\n      }\n\n      keys = Object.keys(updateQuery[m]);\n      keys.forEach(function (k) {\n        modifierFunctions[m](newDoc, k, updateQuery[m][k]);\n      });\n    });\n  }\n\n  // Check result is valid and return it\n  checkObject(newDoc);\n\n  if (obj._id !== newDoc._id) { throw new Error(\"You can't change a document's _id\"); }\n  return newDoc;\n};\n\n\n// ==============================================================\n// Finding documents\n// ==============================================================\n\n/**\n * Get a value from object with dot notation\n * @param {Object} obj\n * @param {String} field\n */\nfunction getDotValue (obj, field) {\n  var fieldParts = typeof field === 'string' ? field.split('.') : field\n    , i, objs;\n\n  if (!obj) { return undefined; }   // field cannot be empty so that means we should return undefined so that nothing can match\n\n  if (fieldParts.length === 0) { return obj; }\n\n  if (fieldParts.length === 1) { return obj[fieldParts[0]]; }\n\n  if (util.isArray(obj[fieldParts[0]])) {\n    // If the next field is an integer, return only this item of the array\n    i = parseInt(fieldParts[1], 10);\n    if (typeof i === 'number' && !isNaN(i)) {\n      return getDotValue(obj[fieldParts[0]][i], fieldParts.slice(2))\n    }\n\n    // Return the array of values\n    objs = new Array();\n    for (i = 0; i < obj[fieldParts[0]].length; i += 1) {\n       objs.push(getDotValue(obj[fieldParts[0]][i], fieldParts.slice(1)));\n    }\n    return objs;\n  } else {\n    return getDotValue(obj[fieldParts[0]], fieldParts.slice(1));\n  }\n}\n\n\n/**\n * Check whether 'things' are equal\n * Things are defined as any native types (string, number, boolean, null, date) and objects\n * In the case of object, we check deep equality\n * Returns true if they are, false otherwise\n */\nfunction areThingsEqual (a, b) {\n  var aKeys , bKeys , i;\n\n  // Strings, booleans, numbers, null\n  if (a === null || typeof a === 'string' || typeof a === 'boolean' || typeof a === 'number' ||\n      b === null || typeof b === 'string' || typeof b === 'boolean' || typeof b === 'number') { return a === b; }\n\n  // Dates\n  if (util.isDate(a) || util.isDate(b)) { return util.isDate(a) && util.isDate(b) && a.getTime() === b.getTime(); }\n\n  // Arrays (no match since arrays are used as a $in)\n  // undefined (no match since they mean field doesn't exist and can't be serialized)\n  if ((!(util.isArray(a) && util.isArray(b)) && (util.isArray(a) || util.isArray(b))) || a === undefined || b === undefined) { return false; }\n\n  // General objects (check for deep equality)\n  // a and b should be objects at this point\n  try {\n    aKeys = Object.keys(a);\n    bKeys = Object.keys(b);\n  } catch (e) {\n    return false;\n  }\n\n  if (aKeys.length !== bKeys.length) { return false; }\n  for (i = 0; i < aKeys.length; i += 1) {\n    if (bKeys.indexOf(aKeys[i]) === -1) { return false; }\n    if (!areThingsEqual(a[aKeys[i]], b[aKeys[i]])) { return false; }\n  }\n  return true;\n}\n\n\n/**\n * Check that two values are comparable\n */\nfunction areComparable (a, b) {\n  if (typeof a !== 'string' && typeof a !== 'number' && !util.isDate(a) &&\n      typeof b !== 'string' && typeof b !== 'number' && !util.isDate(b)) {\n    return false;\n  }\n\n  if (typeof a !== typeof b) { return false; }\n\n  return true;\n}\n\n\n/**\n * Arithmetic and comparison operators\n * @param {Native value} a Value in the object\n * @param {Native value} b Value in the query\n */\ncomparisonFunctions.$lt = function (a, b) {\n  return areComparable(a, b) && a < b;\n};\n\ncomparisonFunctions.$lte = function (a, b) {\n  return areComparable(a, b) && a <= b;\n};\n\ncomparisonFunctions.$gt = function (a, b) {\n  return areComparable(a, b) && a > b;\n};\n\ncomparisonFunctions.$gte = function (a, b) {\n  return areComparable(a, b) && a >= b;\n};\n\ncomparisonFunctions.$ne = function (a, b) {\n  if (a === undefined) { return true; }\n  return !areThingsEqual(a, b);\n};\n\ncomparisonFunctions.$in = function (a, b) {\n  var i;\n\n  if (!util.isArray(b)) { throw new Error(\"$in operator called with a non-array\"); }\n\n  for (i = 0; i < b.length; i += 1) {\n    if (areThingsEqual(a, b[i])) { return true; }\n  }\n\n  return false;\n};\n\ncomparisonFunctions.$nin = function (a, b) {\n  if (!util.isArray(b)) { throw new Error(\"$nin operator called with a non-array\"); }\n\n  return !comparisonFunctions.$in(a, b);\n};\n\ncomparisonFunctions.$regex = function (a, b) {\n  if (!util.isRegExp(b)) { throw new Error(\"$regex operator called with non regular expression\"); }\n\n  if (typeof a !== 'string') {\n    return false\n  } else {\n    return b.test(a);\n  }\n};\n\ncomparisonFunctions.$exists = function (value, exists) {\n  if (exists || exists === '') {   // This will be true for all values of exists except false, null, undefined and 0\n    exists = true;                 // That's strange behaviour (we should only use true/false) but that's the way Mongo does it...\n  } else {\n    exists = false;\n  }\n\n  if (value === undefined) {\n    return !exists\n  } else {\n    return exists;\n  }\n};\n\n// Specific to arrays\ncomparisonFunctions.$size = function (obj, value) {\n    if (!util.isArray(obj)) { return false; }\n    if (value % 1 !== 0) { throw new Error(\"$size operator called without an integer\"); }\n\n    return (obj.length == value);\n};\ncomparisonFunctions.$elemMatch = function (obj, value) {\n  if (!util.isArray(obj)) { return false; }\n  var i = obj.length;\n  var result = false;   // Initialize result\n  while (i--) {\n    if (match(obj[i], value)) {   // If match for array element, return true\n      result = true;\n      break;\n    }\n  }\n  return result;\n};\narrayComparisonFunctions.$size = true;\narrayComparisonFunctions.$elemMatch = true;\n\n\n/**\n * Match any of the subqueries\n * @param {Model} obj\n * @param {Array of Queries} query\n */\nlogicalOperators.$or = function (obj, query) {\n  var i;\n\n  if (!util.isArray(query)) { throw new Error(\"$or operator used without an array\"); }\n\n  for (i = 0; i < query.length; i += 1) {\n    if (match(obj, query[i])) { return true; }\n  }\n\n  return false;\n};\n\n\n/**\n * Match all of the subqueries\n * @param {Model} obj\n * @param {Array of Queries} query\n */\nlogicalOperators.$and = function (obj, query) {\n  var i;\n\n  if (!util.isArray(query)) { throw new Error(\"$and operator used without an array\"); }\n\n  for (i = 0; i < query.length; i += 1) {\n    if (!match(obj, query[i])) { return false; }\n  }\n\n  return true;\n};\n\n\n/**\n * Inverted match of the query\n * @param {Model} obj\n * @param {Query} query\n */\nlogicalOperators.$not = function (obj, query) {\n  return !match(obj, query);\n};\n\n\n/**\n * Use a function to match\n * @param {Model} obj\n * @param {Query} query\n */\nlogicalOperators.$where = function (obj, fn) {\n  var result;\n\n  if (!_.isFunction(fn)) { throw new Error(\"$where operator used without a function\"); }\n\n  result = fn.call(obj);\n  if (!_.isBoolean(result)) { throw new Error(\"$where function must return boolean\"); }\n\n  return result;\n};\n\n\n/**\n * Tell if a given document matches a query\n * @param {Object} obj Document to check\n * @param {Object} query\n */\nfunction match (obj, query) {\n  var queryKeys, queryKey, queryValue, i;\n\n  // Primitive query against a primitive type\n  // This is a bit of a hack since we construct an object with an arbitrary key only to dereference it later\n  // But I don't have time for a cleaner implementation now\n  if (isPrimitiveType(obj) || isPrimitiveType(query)) {\n    return matchQueryPart({ needAKey: obj }, 'needAKey', query);\n  }\n\n  // Normal query\n  queryKeys = Object.keys(query);\n  for (i = 0; i < queryKeys.length; i += 1) {\n    queryKey = queryKeys[i];\n    queryValue = query[queryKey];\n\n    if (queryKey[0] === '$') {\n      if (!logicalOperators[queryKey]) { throw new Error(\"Unknown logical operator \" + queryKey); }\n      if (!logicalOperators[queryKey](obj, queryValue)) { return false; }\n    } else {\n      if (!matchQueryPart(obj, queryKey, queryValue)) { return false; }\n    }\n  }\n\n  return true;\n};\n\n\n/**\n * Match an object against a specific { key: value } part of a query\n * if the treatObjAsValue flag is set, don't try to match every part separately, but the array as a whole\n */\nfunction matchQueryPart (obj, queryKey, queryValue, treatObjAsValue) {\n  var objValue = getDotValue(obj, queryKey)\n    , i, keys, firstChars, dollarFirstChars;\n\n  // Check if the value is an array if we don't force a treatment as value\n  if (util.isArray(objValue) && !treatObjAsValue) {\n    // If the queryValue is an array, try to perform an exact match\n    if (util.isArray(queryValue)) {\n      return matchQueryPart(obj, queryKey, queryValue, true);\n    }\n\n    // Check if we are using an array-specific comparison function\n    if (queryValue !== null && typeof queryValue === 'object' && !util.isRegExp(queryValue)) {\n      keys = Object.keys(queryValue);\n      for (i = 0; i < keys.length; i += 1) {\n        if (arrayComparisonFunctions[keys[i]]) { return matchQueryPart(obj, queryKey, queryValue, true); }\n      }\n    }\n\n    // If not, treat it as an array of { obj, query } where there needs to be at least one match\n    for (i = 0; i < objValue.length; i += 1) {\n      if (matchQueryPart({ k: objValue[i] }, 'k', queryValue)) { return true; }   // k here could be any string\n    }\n    return false;\n  }\n\n  // queryValue is an actual object. Determine whether it contains comparison operators\n  // or only normal fields. Mixed objects are not allowed\n  if (queryValue !== null && typeof queryValue === 'object' && !util.isRegExp(queryValue) && !util.isArray(queryValue)) {\n    keys = Object.keys(queryValue);\n    firstChars = _.map(keys, function (item) { return item[0]; });\n    dollarFirstChars = _.filter(firstChars, function (c) { return c === '$'; });\n\n    if (dollarFirstChars.length !== 0 && dollarFirstChars.length !== firstChars.length) {\n      throw new Error(\"You cannot mix operators and normal fields\");\n    }\n\n    // queryValue is an object of this form: { $comparisonOperator1: value1, ... }\n    if (dollarFirstChars.length > 0) {\n      for (i = 0; i < keys.length; i += 1) {\n        if (!comparisonFunctions[keys[i]]) { throw new Error(\"Unknown comparison function \" + keys[i]); }\n\n        if (!comparisonFunctions[keys[i]](objValue, queryValue[keys[i]])) { return false; }\n      }\n      return true;\n    }\n  }\n\n  // Using regular expressions with basic querying\n  if (util.isRegExp(queryValue)) { return comparisonFunctions.$regex(objValue, queryValue); }\n\n  // queryValue is either a native value or a normal object\n  // Basic matching is possible\n  if (!areThingsEqual(objValue, queryValue)) { return false; }\n\n  return true;\n}\n\n\n// Interface\nmodule.exports.serialize = serialize;\nmodule.exports.deserialize = deserialize;\nmodule.exports.deepCopy = deepCopy;\nmodule.exports.checkObject = checkObject;\nmodule.exports.isPrimitiveType = isPrimitiveType;\nmodule.exports.modify = modify;\nmodule.exports.getDotValue = getDotValue;\nmodule.exports.match = match;\nmodule.exports.areThingsEqual = areThingsEqual;\nmodule.exports.compareThings = compareThings;\n","/**\n * Handle every persistence-related task\n * The interface Datastore expects to be implemented is\n * * Persistence.loadDatabase(callback) and callback has signature err\n * * Persistence.persistNewState(newDocs, callback) where newDocs is an array of documents and callback has signature err\n */\n\nvar storage = require('./storage')\n  , path = require('path')\n  , model = require('./model')\n  , async = require('async')\n  , customUtils = require('./customUtils')\n  , Index = require('./indexes')\n  ;\n\n\n/**\n * Create a new Persistence object for database options.db\n * @param {Datastore} options.db\n * @param {Boolean} options.nodeWebkitAppName Optional, specify the name of your NW app if you want options.filename to be relative to the directory where\n *                                            Node Webkit stores application data such as cookies and local storage (the best place to store data in my opinion)\n */\nfunction Persistence (options) {\n  var i, j, randomString;\n\n  this.db = options.db;\n  this.inMemoryOnly = this.db.inMemoryOnly;\n  this.filename = this.db.filename;\n  this.corruptAlertThreshold = options.corruptAlertThreshold !== undefined ? options.corruptAlertThreshold : 0.1;\n\n  if (!this.inMemoryOnly && this.filename && this.filename.charAt(this.filename.length - 1) === '~') {\n    throw new Error(\"The datafile name can't end with a ~, which is reserved for crash safe backup files\");\n  }\n\n  // After serialization and before deserialization hooks with some basic sanity checks\n  if (options.afterSerialization && !options.beforeDeserialization) {\n    throw new Error(\"Serialization hook defined but deserialization hook undefined, cautiously refusing to start NeDB to prevent dataloss\");\n  }\n  if (!options.afterSerialization && options.beforeDeserialization) {\n    throw new Error(\"Serialization hook undefined but deserialization hook defined, cautiously refusing to start NeDB to prevent dataloss\");\n  }\n  this.afterSerialization = options.afterSerialization || function (s) { return s; };\n  this.beforeDeserialization = options.beforeDeserialization || function (s) { return s; };\n  for (i = 1; i < 30; i += 1) {\n    for (j = 0; j < 10; j += 1) {\n      randomString = customUtils.uid(i);\n      if (this.beforeDeserialization(this.afterSerialization(randomString)) !== randomString) {\n        throw new Error(\"beforeDeserialization is not the reverse of afterSerialization, cautiously refusing to start NeDB to prevent dataloss\");\n      }\n    }\n  }\n\n  // For NW apps, store data in the same directory where NW stores application data\n  if (this.filename && options.nodeWebkitAppName) {\n    console.log(\"==================================================================\");\n    console.log(\"WARNING: The nodeWebkitAppName option is deprecated\");\n    console.log(\"To get the path to the directory where Node Webkit stores the data\");\n    console.log(\"for your app, use the internal nw.gui module like this\");\n    console.log(\"require('nw.gui').App.dataPath\");\n    console.log(\"See https://github.com/rogerwang/node-webkit/issues/500\");\n    console.log(\"==================================================================\");\n    this.filename = Persistence.getNWAppFilename(options.nodeWebkitAppName, this.filename);\n  }\n};\n\n\n/**\n * Check if a directory exists and create it on the fly if it is not the case\n * cb is optional, signature: err\n */\nPersistence.ensureDirectoryExists = function (dir, cb) {\n  var callback = cb || function () {}\n    ;\n\n  storage.mkdirp(dir, function (err) { return callback(err); });\n};\n\n\n\n\n/**\n * Return the path the datafile if the given filename is relative to the directory where Node Webkit stores\n * data for this application. Probably the best place to store data\n */\nPersistence.getNWAppFilename = function (appName, relativeFilename) {\n  var home;\n\n  switch (process.platform) {\n    case 'win32':\n    case 'win64':\n      home = process.env.LOCALAPPDATA || process.env.APPDATA;\n      if (!home) { throw new Error(\"Couldn't find the base application data folder\"); }\n      home = path.join(home, appName);\n      break;\n    case 'darwin':\n      home = process.env.HOME;\n      if (!home) { throw new Error(\"Couldn't find the base application data directory\"); }\n      home = path.join(home, 'Library', 'Application Support', appName);\n      break;\n    case 'linux':\n      home = process.env.HOME;\n      if (!home) { throw new Error(\"Couldn't find the base application data directory\"); }\n      home = path.join(home, '.config', appName);\n      break;\n    default:\n      throw new Error(\"Can't use the Node Webkit relative path for platform \" + process.platform);\n      break;\n  }\n\n  return path.join(home, 'nedb-data', relativeFilename);\n}\n\n\n/**\n * Persist cached database\n * This serves as a compaction function since the cache always contains only the number of documents in the collection\n * while the data file is append-only so it may grow larger\n * @param {Function} cb Optional callback, signature: err\n */\nPersistence.prototype.persistCachedDatabase = function (cb) {\n  var callback = cb || function () {}\n    , toPersist = ''\n    , self = this\n    ;\n\n  if (this.inMemoryOnly) { return callback(null); }\n\n  this.db.getAllData().forEach(function (doc) {\n    toPersist += self.afterSerialization(model.serialize(doc)) + '\\n';\n  });\n  Object.keys(this.db.indexes).forEach(function (fieldName) {\n    if (fieldName != \"_id\") {   // The special _id index is managed by datastore.js, the others need to be persisted\n      toPersist += self.afterSerialization(model.serialize({ $$indexCreated: { fieldName: fieldName, unique: self.db.indexes[fieldName].unique, sparse: self.db.indexes[fieldName].sparse }})) + '\\n';\n    }\n  });\n\n  storage.crashSafeWriteFile(this.filename, toPersist, function (err) {\n    if (err) { return callback(err); }\n    self.db.emit('compaction.done');\n    return callback(null);\n  });\n};\n\n\n/**\n * Queue a rewrite of the datafile\n */\nPersistence.prototype.compactDatafile = function () {\n  this.db.executor.push({ this: this, fn: this.persistCachedDatabase, arguments: [] });\n};\n\n\n/**\n * Set automatic compaction every interval ms\n * @param {Number} interval in milliseconds, with an enforced minimum of 5 seconds\n */\nPersistence.prototype.setAutocompactionInterval = function (interval) {\n  var self = this\n    , minInterval = 5000\n    , realInterval = Math.max(interval || 0, minInterval)\n    ;\n\n  this.stopAutocompaction();\n\n  this.autocompactionIntervalId = setInterval(function () {\n    self.compactDatafile();\n  }, realInterval);\n};\n\n\n/**\n * Stop autocompaction (do nothing if autocompaction was not running)\n */\nPersistence.prototype.stopAutocompaction = function () {\n  if (this.autocompactionIntervalId) { clearInterval(this.autocompactionIntervalId); }\n};\n\n\n/**\n * Persist new state for the given newDocs (can be insertion, update or removal)\n * Use an append-only format\n * @param {Array} newDocs Can be empty if no doc was updated/removed\n * @param {Function} cb Optional, signature: err\n */\nPersistence.prototype.persistNewState = function (newDocs, cb) {\n  var self = this\n    , toPersist = ''\n    , callback = cb || function () {}\n    ;\n\n  // In-memory only datastore\n  if (self.inMemoryOnly) { return callback(null); }\n\n  newDocs.forEach(function (doc) {\n    toPersist += self.afterSerialization(model.serialize(doc)) + '\\n';\n  });\n\n  if (toPersist.length === 0) { return callback(null); }\n\n  storage.appendFile(self.filename, toPersist, 'utf8', function (err) {\n    return callback(err);\n  });\n};\n\n\n/**\n * From a database's raw data, return the corresponding\n * machine understandable collection\n */\nPersistence.prototype.treatRawData = function (rawData) {\n  var data = rawData.split('\\n')\n    , dataById = {}\n    , tdata = []\n    , i\n    , indexes = {}\n    , corruptItems = -1   // Last line of every data file is usually blank so not really corrupt\n    ;\n\n  for (i = 0; i < data.length; i += 1) {\n    var doc;\n\n    try {\n      doc = model.deserialize(this.beforeDeserialization(data[i]));\n      if (doc._id) {\n        if (doc.$$deleted === true) {\n          delete dataById[doc._id];\n        } else {\n          dataById[doc._id] = doc;\n        }\n      } else if (doc.$$indexCreated && doc.$$indexCreated.fieldName != undefined) {\n        indexes[doc.$$indexCreated.fieldName] = doc.$$indexCreated;\n      } else if (typeof doc.$$indexRemoved === \"string\") {\n        delete indexes[doc.$$indexRemoved];\n      }\n    } catch (e) {\n      corruptItems += 1;\n    }\n  }\n\n  // A bit lenient on corruption\n  if (data.length > 0 && corruptItems / data.length > this.corruptAlertThreshold) {\n    throw new Error(\"More than \" + Math.floor(100 * this.corruptAlertThreshold) + \"% of the data file is corrupt, the wrong beforeDeserialization hook may be used. Cautiously refusing to start NeDB to prevent dataloss\");\n  }\n\n  Object.keys(dataById).forEach(function (k) {\n    tdata.push(dataById[k]);\n  });\n\n  return { data: tdata, indexes: indexes };\n};\n\n\n/**\n * Load the database\n * 1) Create all indexes\n * 2) Insert all data\n * 3) Compact the database\n * This means pulling data out of the data file or creating it if it doesn't exist\n * Also, all data is persisted right away, which has the effect of compacting the database file\n * This operation is very quick at startup for a big collection (60ms for ~10k docs)\n * @param {Function} cb Optional callback, signature: err\n */\nPersistence.prototype.loadDatabase = function (cb) {\n  var callback = cb || function () {}\n    , self = this\n    ;\n\n  self.db.resetIndexes();\n\n  // In-memory only datastore\n  if (self.inMemoryOnly) { return callback(null); }\n\n  async.waterfall([\n    function (cb) {\n      Persistence.ensureDirectoryExists(path.dirname(self.filename), function (err) {\n        storage.ensureDatafileIntegrity(self.filename, function (err) {\n          storage.readFile(self.filename, 'utf8', function (err, rawData) {\n            if (err) { return cb(err); }\n\n            try {\n              var treatedData = self.treatRawData(rawData);\n            } catch (e) {\n              return cb(e);\n            }\n\n            // Recreate all indexes in the datafile\n            Object.keys(treatedData.indexes).forEach(function (key) {\n              self.db.indexes[key] = new Index(treatedData.indexes[key]);\n            });\n\n            // Fill cached database (i.e. all indexes) with data\n            try {\n              self.db.resetIndexes(treatedData.data);\n            } catch (e) {\n              self.db.resetIndexes();   // Rollback any index which didn't fail\n              return cb(e);\n            }\n\n            self.db.persistence.persistCachedDatabase(cb);\n          });\n        });\n      });\n    }\n  ], function (err) {\n       if (err) { return callback(err); }\n\n       self.db.executor.processBuffer();\n       return callback(null);\n     });\n};\n\n\n// Interface\nmodule.exports = Persistence;\n","/**\n * Way data is stored for this database\n * For a Node.js/Node Webkit database it's the file system\n * For a browser-side database it's localforage which chooses the best option depending on user browser (IndexedDB then WebSQL then localStorage)\n *\n * This version is the Node.js/Node Webkit version\n * It's essentially fs, mkdirp and crash safe write and read functions\n */\n\nvar fs = require('fs')\n  , mkdirp = require('mkdirp')\n  , async = require('async')\n  , path = require('path')\n  , storage = {}\n  ;\n\nstorage.exists = fs.exists;\nstorage.rename = fs.rename;\nstorage.writeFile = fs.writeFile;\nstorage.unlink = fs.unlink;\nstorage.appendFile = fs.appendFile;\nstorage.readFile = fs.readFile;\nstorage.mkdirp = mkdirp;\n\n\n/**\n * Explicit name ...\n */\nstorage.ensureFileDoesntExist = function (file, callback) {\n  storage.exists(file, function (exists) {\n    if (!exists) { return callback(null); }\n\n    storage.unlink(file, function (err) { return callback(err); });\n  });\n};\n\n\n/**\n * Flush data in OS buffer to storage if corresponding option is set\n * @param {String} options.filename\n * @param {Boolean} options.isDir Optional, defaults to false\n * If options is a string, it is assumed that the flush of the file (not dir) called options was requested\n */\nstorage.flushToStorage = function (options, callback) {\n  var filename, flags;\n  if (typeof options === 'string') {\n    filename = options;\n    flags = 'r+';\n  } else {\n    filename = options.filename;\n    flags = options.isDir ? 'r' : 'r+';\n  }\n\n  // Windows can't fsync (FlushFileBuffers) directories. We can live with this as it cannot cause 100% dataloss\n  // except in the very rare event of the first time database is loaded and a crash happens\n  if (flags === 'r' && (process.platform === 'win32' || process.platform === 'win64')) { return callback(null); }\n\n  fs.open(filename, flags, function (err, fd) {\n    if (err) { return callback(err); }\n    fs.fsync(fd, function (errFS) {\n      fs.close(fd, function (errC) {\n        if (errFS || errC) {\n          var e = new Error('Failed to flush to storage');\n          e.errorOnFsync = errFS;\n          e.errorOnClose = errC;\n          return callback(e);\n        } else {\n          return callback(null);\n        }\n      });\n    });\n  });\n};\n\n\n/**\n * Fully write or rewrite the datafile, immune to crashes during the write operation (data will not be lost)\n * @param {String} filename\n * @param {String} data\n * @param {Function} cb Optional callback, signature: err\n */\nstorage.crashSafeWriteFile = function (filename, data, cb) {\n  var callback = cb || function () {}\n    , tempFilename = filename + '~';\n\n  async.waterfall([\n    async.apply(storage.flushToStorage, { filename: path.dirname(filename), isDir: true })\n  , function (cb) {\n      storage.exists(filename, function (exists) {\n        if (exists) {\n          storage.flushToStorage(filename, function (err) { return cb(err); });\n        } else {\n          return cb();\n        }\n      });\n    }\n  , function (cb) {\n      storage.writeFile(tempFilename, data, function (err) { return cb(err); });\n    }\n  , async.apply(storage.flushToStorage, tempFilename)\n  , function (cb) {\n      storage.rename(tempFilename, filename, function (err) { return cb(err); });\n    }\n  , async.apply(storage.flushToStorage, { filename: path.dirname(filename), isDir: true })\n  ], function (err) { return callback(err); })\n};\n\n\n/**\n * Ensure the datafile contains all the data, even if there was a crash during a full file write\n * @param {String} filename\n * @param {Function} callback signature: err\n */\nstorage.ensureDatafileIntegrity = function (filename, callback) {\n  var tempFilename = filename + '~';\n\n  storage.exists(filename, function (filenameExists) {\n    // Write was successful\n    if (filenameExists) { return callback(null); }\n\n    storage.exists(tempFilename, function (oldFilenameExists) {\n      // New database\n      if (!oldFilenameExists) {\n        return storage.writeFile(filename, '', 'utf8', function (err) { callback(err); });\n      }\n\n      // Write failed, use old version\n      storage.rename(tempFilename, filename, function (err) { return callback(err); });\n    });\n  });\n};\n\n\n\n// Interface\nmodule.exports = storage;\n","//     Underscore.js 1.4.4\n//     http://underscorejs.org\n//     (c) 2009-2013 Jeremy Ashkenas, DocumentCloud Inc.\n//     Underscore may be freely distributed under the MIT license.\n\n(function() {\n\n  // Baseline setup\n  // --------------\n\n  // Establish the root object, `window` in the browser, or `global` on the server.\n  var root = this;\n\n  // Save the previous value of the `_` variable.\n  var previousUnderscore = root._;\n\n  // Establish the object that gets returned to break out of a loop iteration.\n  var breaker = {};\n\n  // Save bytes in the minified (but not gzipped) version:\n  var ArrayProto = Array.prototype, ObjProto = Object.prototype, FuncProto = Function.prototype;\n\n  // Create quick reference variables for speed access to core prototypes.\n  var push             = ArrayProto.push,\n      slice            = ArrayProto.slice,\n      concat           = ArrayProto.concat,\n      toString         = ObjProto.toString,\n      hasOwnProperty   = ObjProto.hasOwnProperty;\n\n  // All **ECMAScript 5** native function implementations that we hope to use\n  // are declared here.\n  var\n    nativeForEach      = ArrayProto.forEach,\n    nativeMap          = ArrayProto.map,\n    nativeReduce       = ArrayProto.reduce,\n    nativeReduceRight  = ArrayProto.reduceRight,\n    nativeFilter       = ArrayProto.filter,\n    nativeEvery        = ArrayProto.every,\n    nativeSome         = ArrayProto.some,\n    nativeIndexOf      = ArrayProto.indexOf,\n    nativeLastIndexOf  = ArrayProto.lastIndexOf,\n    nativeIsArray      = Array.isArray,\n    nativeKeys         = Object.keys,\n    nativeBind         = FuncProto.bind;\n\n  // Create a safe reference to the Underscore object for use below.\n  var _ = function(obj) {\n    if (obj instanceof _) return obj;\n    if (!(this instanceof _)) return new _(obj);\n    this._wrapped = obj;\n  };\n\n  // Export the Underscore object for **Node.js**, with\n  // backwards-compatibility for the old `require()` API. If we're in\n  // the browser, add `_` as a global object via a string identifier,\n  // for Closure Compiler \"advanced\" mode.\n  if (typeof exports !== 'undefined') {\n    if (typeof module !== 'undefined' && module.exports) {\n      exports = module.exports = _;\n    }\n    exports._ = _;\n  } else {\n    root._ = _;\n  }\n\n  // Current version.\n  _.VERSION = '1.4.4';\n\n  // Collection Functions\n  // --------------------\n\n  // The cornerstone, an `each` implementation, aka `forEach`.\n  // Handles objects with the built-in `forEach`, arrays, and raw objects.\n  // Delegates to **ECMAScript 5**'s native `forEach` if available.\n  var each = _.each = _.forEach = function(obj, iterator, context) {\n    if (obj == null) return;\n    if (nativeForEach && obj.forEach === nativeForEach) {\n      obj.forEach(iterator, context);\n    } else if (obj.length === +obj.length) {\n      for (var i = 0, l = obj.length; i < l; i++) {\n        if (iterator.call(context, obj[i], i, obj) === breaker) return;\n      }\n    } else {\n      for (var key in obj) {\n        if (_.has(obj, key)) {\n          if (iterator.call(context, obj[key], key, obj) === breaker) return;\n        }\n      }\n    }\n  };\n\n  // Return the results of applying the iterator to each element.\n  // Delegates to **ECMAScript 5**'s native `map` if available.\n  _.map = _.collect = function(obj, iterator, context) {\n    var results = [];\n    if (obj == null) return results;\n    if (nativeMap && obj.map === nativeMap) return obj.map(iterator, context);\n    each(obj, function(value, index, list) {\n      results[results.length] = iterator.call(context, value, index, list);\n    });\n    return results;\n  };\n\n  var reduceError = 'Reduce of empty array with no initial value';\n\n  // **Reduce** builds up a single result from a list of values, aka `inject`,\n  // or `foldl`. Delegates to **ECMAScript 5**'s native `reduce` if available.\n  _.reduce = _.foldl = _.inject = function(obj, iterator, memo, context) {\n    var initial = arguments.length > 2;\n    if (obj == null) obj = [];\n    if (nativeReduce && obj.reduce === nativeReduce) {\n      if (context) iterator = _.bind(iterator, context);\n      return initial ? obj.reduce(iterator, memo) : obj.reduce(iterator);\n    }\n    each(obj, function(value, index, list) {\n      if (!initial) {\n        memo = value;\n        initial = true;\n      } else {\n        memo = iterator.call(context, memo, value, index, list);\n      }\n    });\n    if (!initial) throw new TypeError(reduceError);\n    return memo;\n  };\n\n  // The right-associative version of reduce, also known as `foldr`.\n  // Delegates to **ECMAScript 5**'s native `reduceRight` if available.\n  _.reduceRight = _.foldr = function(obj, iterator, memo, context) {\n    var initial = arguments.length > 2;\n    if (obj == null) obj = [];\n    if (nativeReduceRight && obj.reduceRight === nativeReduceRight) {\n      if (context) iterator = _.bind(iterator, context);\n      return initial ? obj.reduceRight(iterator, memo) : obj.reduceRight(iterator);\n    }\n    var length = obj.length;\n    if (length !== +length) {\n      var keys = _.keys(obj);\n      length = keys.length;\n    }\n    each(obj, function(value, index, list) {\n      index = keys ? keys[--length] : --length;\n      if (!initial) {\n        memo = obj[index];\n        initial = true;\n      } else {\n        memo = iterator.call(context, memo, obj[index], index, list);\n      }\n    });\n    if (!initial) throw new TypeError(reduceError);\n    return memo;\n  };\n\n  // Return the first value which passes a truth test. Aliased as `detect`.\n  _.find = _.detect = function(obj, iterator, context) {\n    var result;\n    any(obj, function(value, index, list) {\n      if (iterator.call(context, value, index, list)) {\n        result = value;\n        return true;\n      }\n    });\n    return result;\n  };\n\n  // Return all the elements that pass a truth test.\n  // Delegates to **ECMAScript 5**'s native `filter` if available.\n  // Aliased as `select`.\n  _.filter = _.select = function(obj, iterator, context) {\n    var results = [];\n    if (obj == null) return results;\n    if (nativeFilter && obj.filter === nativeFilter) return obj.filter(iterator, context);\n    each(obj, function(value, index, list) {\n      if (iterator.call(context, value, index, list)) results[results.length] = value;\n    });\n    return results;\n  };\n\n  // Return all the elements for which a truth test fails.\n  _.reject = function(obj, iterator, context) {\n    return _.filter(obj, function(value, index, list) {\n      return !iterator.call(context, value, index, list);\n    }, context);\n  };\n\n  // Determine whether all of the elements match a truth test.\n  // Delegates to **ECMAScript 5**'s native `every` if available.\n  // Aliased as `all`.\n  _.every = _.all = function(obj, iterator, context) {\n    iterator || (iterator = _.identity);\n    var result = true;\n    if (obj == null) return result;\n    if (nativeEvery && obj.every === nativeEvery) return obj.every(iterator, context);\n    each(obj, function(value, index, list) {\n      if (!(result = result && iterator.call(context, value, index, list))) return breaker;\n    });\n    return !!result;\n  };\n\n  // Determine if at least one element in the object matches a truth test.\n  // Delegates to **ECMAScript 5**'s native `some` if available.\n  // Aliased as `any`.\n  var any = _.some = _.any = function(obj, iterator, context) {\n    iterator || (iterator = _.identity);\n    var result = false;\n    if (obj == null) return result;\n    if (nativeSome && obj.some === nativeSome) return obj.some(iterator, context);\n    each(obj, function(value, index, list) {\n      if (result || (result = iterator.call(context, value, index, list))) return breaker;\n    });\n    return !!result;\n  };\n\n  // Determine if the array or object contains a given value (using `===`).\n  // Aliased as `include`.\n  _.contains = _.include = function(obj, target) {\n    if (obj == null) return false;\n    if (nativeIndexOf && obj.indexOf === nativeIndexOf) return obj.indexOf(target) != -1;\n    return any(obj, function(value) {\n      return value === target;\n    });\n  };\n\n  // Invoke a method (with arguments) on every item in a collection.\n  _.invoke = function(obj, method) {\n    var args = slice.call(arguments, 2);\n    var isFunc = _.isFunction(method);\n    return _.map(obj, function(value) {\n      return (isFunc ? method : value[method]).apply(value, args);\n    });\n  };\n\n  // Convenience version of a common use case of `map`: fetching a property.\n  _.pluck = function(obj, key) {\n    return _.map(obj, function(value){ return value[key]; });\n  };\n\n  // Convenience version of a common use case of `filter`: selecting only objects\n  // containing specific `key:value` pairs.\n  _.where = function(obj, attrs, first) {\n    if (_.isEmpty(attrs)) return first ? null : [];\n    return _[first ? 'find' : 'filter'](obj, function(value) {\n      for (var key in attrs) {\n        if (attrs[key] !== value[key]) return false;\n      }\n      return true;\n    });\n  };\n\n  // Convenience version of a common use case of `find`: getting the first object\n  // containing specific `key:value` pairs.\n  _.findWhere = function(obj, attrs) {\n    return _.where(obj, attrs, true);\n  };\n\n  // Return the maximum element or (element-based computation).\n  // Can't optimize arrays of integers longer than 65,535 elements.\n  // See: https://bugs.webkit.org/show_bug.cgi?id=80797\n  _.max = function(obj, iterator, context) {\n    if (!iterator && _.isArray(obj) && obj[0] === +obj[0] && obj.length < 65535) {\n      return Math.max.apply(Math, obj);\n    }\n    if (!iterator && _.isEmpty(obj)) return -Infinity;\n    var result = {computed : -Infinity, value: -Infinity};\n    each(obj, function(value, index, list) {\n      var computed = iterator ? iterator.call(context, value, index, list) : value;\n      computed >= result.computed && (result = {value : value, computed : computed});\n    });\n    return result.value;\n  };\n\n  // Return the minimum element (or element-based computation).\n  _.min = function(obj, iterator, context) {\n    if (!iterator && _.isArray(obj) && obj[0] === +obj[0] && obj.length < 65535) {\n      return Math.min.apply(Math, obj);\n    }\n    if (!iterator && _.isEmpty(obj)) return Infinity;\n    var result = {computed : Infinity, value: Infinity};\n    each(obj, function(value, index, list) {\n      var computed = iterator ? iterator.call(context, value, index, list) : value;\n      computed < result.computed && (result = {value : value, computed : computed});\n    });\n    return result.value;\n  };\n\n  // Shuffle an array.\n  _.shuffle = function(obj) {\n    var rand;\n    var index = 0;\n    var shuffled = [];\n    each(obj, function(value) {\n      rand = _.random(index++);\n      shuffled[index - 1] = shuffled[rand];\n      shuffled[rand] = value;\n    });\n    return shuffled;\n  };\n\n  // An internal function to generate lookup iterators.\n  var lookupIterator = function(value) {\n    return _.isFunction(value) ? value : function(obj){ return obj[value]; };\n  };\n\n  // Sort the object's values by a criterion produced by an iterator.\n  _.sortBy = function(obj, value, context) {\n    var iterator = lookupIterator(value);\n    return _.pluck(_.map(obj, function(value, index, list) {\n      return {\n        value : value,\n        index : index,\n        criteria : iterator.call(context, value, index, list)\n      };\n    }).sort(function(left, right) {\n      var a = left.criteria;\n      var b = right.criteria;\n      if (a !== b) {\n        if (a > b || a === void 0) return 1;\n        if (a < b || b === void 0) return -1;\n      }\n      return left.index < right.index ? -1 : 1;\n    }), 'value');\n  };\n\n  // An internal function used for aggregate \"group by\" operations.\n  var group = function(obj, value, context, behavior) {\n    var result = {};\n    var iterator = lookupIterator(value || _.identity);\n    each(obj, function(value, index) {\n      var key = iterator.call(context, value, index, obj);\n      behavior(result, key, value);\n    });\n    return result;\n  };\n\n  // Groups the object's values by a criterion. Pass either a string attribute\n  // to group by, or a function that returns the criterion.\n  _.groupBy = function(obj, value, context) {\n    return group(obj, value, context, function(result, key, value) {\n      (_.has(result, key) ? result[key] : (result[key] = [])).push(value);\n    });\n  };\n\n  // Counts instances of an object that group by a certain criterion. Pass\n  // either a string attribute to count by, or a function that returns the\n  // criterion.\n  _.countBy = function(obj, value, context) {\n    return group(obj, value, context, function(result, key) {\n      if (!_.has(result, key)) result[key] = 0;\n      result[key]++;\n    });\n  };\n\n  // Use a comparator function to figure out the smallest index at which\n  // an object should be inserted so as to maintain order. Uses binary search.\n  _.sortedIndex = function(array, obj, iterator, context) {\n    iterator = iterator == null ? _.identity : lookupIterator(iterator);\n    var value = iterator.call(context, obj);\n    var low = 0, high = array.length;\n    while (low < high) {\n      var mid = (low + high) >>> 1;\n      iterator.call(context, array[mid]) < value ? low = mid + 1 : high = mid;\n    }\n    return low;\n  };\n\n  // Safely convert anything iterable into a real, live array.\n  _.toArray = function(obj) {\n    if (!obj) return [];\n    if (_.isArray(obj)) return slice.call(obj);\n    if (obj.length === +obj.length) return _.map(obj, _.identity);\n    return _.values(obj);\n  };\n\n  // Return the number of elements in an object.\n  _.size = function(obj) {\n    if (obj == null) return 0;\n    return (obj.length === +obj.length) ? obj.length : _.keys(obj).length;\n  };\n\n  // Array Functions\n  // ---------------\n\n  // Get the first element of an array. Passing **n** will return the first N\n  // values in the array. Aliased as `head` and `take`. The **guard** check\n  // allows it to work with `_.map`.\n  _.first = _.head = _.take = function(array, n, guard) {\n    if (array == null) return void 0;\n    return (n != null) && !guard ? slice.call(array, 0, n) : array[0];\n  };\n\n  // Returns everything but the last entry of the array. Especially useful on\n  // the arguments object. Passing **n** will return all the values in\n  // the array, excluding the last N. The **guard** check allows it to work with\n  // `_.map`.\n  _.initial = function(array, n, guard) {\n    return slice.call(array, 0, array.length - ((n == null) || guard ? 1 : n));\n  };\n\n  // Get the last element of an array. Passing **n** will return the last N\n  // values in the array. The **guard** check allows it to work with `_.map`.\n  _.last = function(array, n, guard) {\n    if (array == null) return void 0;\n    if ((n != null) && !guard) {\n      return slice.call(array, Math.max(array.length - n, 0));\n    } else {\n      return array[array.length - 1];\n    }\n  };\n\n  // Returns everything but the first entry of the array. Aliased as `tail` and `drop`.\n  // Especially useful on the arguments object. Passing an **n** will return\n  // the rest N values in the array. The **guard**\n  // check allows it to work with `_.map`.\n  _.rest = _.tail = _.drop = function(array, n, guard) {\n    return slice.call(array, (n == null) || guard ? 1 : n);\n  };\n\n  // Trim out all falsy values from an array.\n  _.compact = function(array) {\n    return _.filter(array, _.identity);\n  };\n\n  // Internal implementation of a recursive `flatten` function.\n  var flatten = function(input, shallow, output) {\n    each(input, function(value) {\n      if (_.isArray(value)) {\n        shallow ? push.apply(output, value) : flatten(value, shallow, output);\n      } else {\n        output.push(value);\n      }\n    });\n    return output;\n  };\n\n  // Return a completely flattened version of an array.\n  _.flatten = function(array, shallow) {\n    return flatten(array, shallow, []);\n  };\n\n  // Return a version of the array that does not contain the specified value(s).\n  _.without = function(array) {\n    return _.difference(array, slice.call(arguments, 1));\n  };\n\n  // Produce a duplicate-free version of the array. If the array has already\n  // been sorted, you have the option of using a faster algorithm.\n  // Aliased as `unique`.\n  _.uniq = _.unique = function(array, isSorted, iterator, context) {\n    if (_.isFunction(isSorted)) {\n      context = iterator;\n      iterator = isSorted;\n      isSorted = false;\n    }\n    var initial = iterator ? _.map(array, iterator, context) : array;\n    var results = [];\n    var seen = [];\n    each(initial, function(value, index) {\n      if (isSorted ? (!index || seen[seen.length - 1] !== value) : !_.contains(seen, value)) {\n        seen.push(value);\n        results.push(array[index]);\n      }\n    });\n    return results;\n  };\n\n  // Produce an array that contains the union: each distinct element from all of\n  // the passed-in arrays.\n  _.union = function() {\n    return _.uniq(concat.apply(ArrayProto, arguments));\n  };\n\n  // Produce an array that contains every item shared between all the\n  // passed-in arrays.\n  _.intersection = function(array) {\n    var rest = slice.call(arguments, 1);\n    return _.filter(_.uniq(array), function(item) {\n      return _.every(rest, function(other) {\n        return _.indexOf(other, item) >= 0;\n      });\n    });\n  };\n\n  // Take the difference between one array and a number of other arrays.\n  // Only the elements present in just the first array will remain.\n  _.difference = function(array) {\n    var rest = concat.apply(ArrayProto, slice.call(arguments, 1));\n    return _.filter(array, function(value){ return !_.contains(rest, value); });\n  };\n\n  // Zip together multiple lists into a single array -- elements that share\n  // an index go together.\n  _.zip = function() {\n    var args = slice.call(arguments);\n    var length = _.max(_.pluck(args, 'length'));\n    var results = new Array(length);\n    for (var i = 0; i < length; i++) {\n      results[i] = _.pluck(args, \"\" + i);\n    }\n    return results;\n  };\n\n  // Converts lists into objects. Pass either a single array of `[key, value]`\n  // pairs, or two parallel arrays of the same length -- one of keys, and one of\n  // the corresponding values.\n  _.object = function(list, values) {\n    if (list == null) return {};\n    var result = {};\n    for (var i = 0, l = list.length; i < l; i++) {\n      if (values) {\n        result[list[i]] = values[i];\n      } else {\n        result[list[i][0]] = list[i][1];\n      }\n    }\n    return result;\n  };\n\n  // If the browser doesn't supply us with indexOf (I'm looking at you, **MSIE**),\n  // we need this function. Return the position of the first occurrence of an\n  // item in an array, or -1 if the item is not included in the array.\n  // Delegates to **ECMAScript 5**'s native `indexOf` if available.\n  // If the array is large and already in sort order, pass `true`\n  // for **isSorted** to use binary search.\n  _.indexOf = function(array, item, isSorted) {\n    if (array == null) return -1;\n    var i = 0, l = array.length;\n    if (isSorted) {\n      if (typeof isSorted == 'number') {\n        i = (isSorted < 0 ? Math.max(0, l + isSorted) : isSorted);\n      } else {\n        i = _.sortedIndex(array, item);\n        return array[i] === item ? i : -1;\n      }\n    }\n    if (nativeIndexOf && array.indexOf === nativeIndexOf) return array.indexOf(item, isSorted);\n    for (; i < l; i++) if (array[i] === item) return i;\n    return -1;\n  };\n\n  // Delegates to **ECMAScript 5**'s native `lastIndexOf` if available.\n  _.lastIndexOf = function(array, item, from) {\n    if (array == null) return -1;\n    var hasIndex = from != null;\n    if (nativeLastIndexOf && array.lastIndexOf === nativeLastIndexOf) {\n      return hasIndex ? array.lastIndexOf(item, from) : array.lastIndexOf(item);\n    }\n    var i = (hasIndex ? from : array.length);\n    while (i--) if (array[i] === item) return i;\n    return -1;\n  };\n\n  // Generate an integer Array containing an arithmetic progression. A port of\n  // the native Python `range()` function. See\n  // [the Python documentation](http://docs.python.org/library/functions.html#range).\n  _.range = function(start, stop, step) {\n    if (arguments.length <= 1) {\n      stop = start || 0;\n      start = 0;\n    }\n    step = arguments[2] || 1;\n\n    var len = Math.max(Math.ceil((stop - start) / step), 0);\n    var idx = 0;\n    var range = new Array(len);\n\n    while(idx < len) {\n      range[idx++] = start;\n      start += step;\n    }\n\n    return range;\n  };\n\n  // Function (ahem) Functions\n  // ------------------\n\n  // Create a function bound to a given object (assigning `this`, and arguments,\n  // optionally). Delegates to **ECMAScript 5**'s native `Function.bind` if\n  // available.\n  _.bind = function(func, context) {\n    if (func.bind === nativeBind && nativeBind) return nativeBind.apply(func, slice.call(arguments, 1));\n    var args = slice.call(arguments, 2);\n    return function() {\n      return func.apply(context, args.concat(slice.call(arguments)));\n    };\n  };\n\n  // Partially apply a function by creating a version that has had some of its\n  // arguments pre-filled, without changing its dynamic `this` context.\n  _.partial = function(func) {\n    var args = slice.call(arguments, 1);\n    return function() {\n      return func.apply(this, args.concat(slice.call(arguments)));\n    };\n  };\n\n  // Bind all of an object's methods to that object. Useful for ensuring that\n  // all callbacks defined on an object belong to it.\n  _.bindAll = function(obj) {\n    var funcs = slice.call(arguments, 1);\n    if (funcs.length === 0) funcs = _.functions(obj);\n    each(funcs, function(f) { obj[f] = _.bind(obj[f], obj); });\n    return obj;\n  };\n\n  // Memoize an expensive function by storing its results.\n  _.memoize = function(func, hasher) {\n    var memo = {};\n    hasher || (hasher = _.identity);\n    return function() {\n      var key = hasher.apply(this, arguments);\n      return _.has(memo, key) ? memo[key] : (memo[key] = func.apply(this, arguments));\n    };\n  };\n\n  // Delays a function for the given number of milliseconds, and then calls\n  // it with the arguments supplied.\n  _.delay = function(func, wait) {\n    var args = slice.call(arguments, 2);\n    return setTimeout(function(){ return func.apply(null, args); }, wait);\n  };\n\n  // Defers a function, scheduling it to run after the current call stack has\n  // cleared.\n  _.defer = function(func) {\n    return _.delay.apply(_, [func, 1].concat(slice.call(arguments, 1)));\n  };\n\n  // Returns a function, that, when invoked, will only be triggered at most once\n  // during a given window of time.\n  _.throttle = function(func, wait) {\n    var context, args, timeout, result;\n    var previous = 0;\n    var later = function() {\n      previous = new Date;\n      timeout = null;\n      result = func.apply(context, args);\n    };\n    return function() {\n      var now = new Date;\n      var remaining = wait - (now - previous);\n      context = this;\n      args = arguments;\n      if (remaining <= 0) {\n        clearTimeout(timeout);\n        timeout = null;\n        previous = now;\n        result = func.apply(context, args);\n      } else if (!timeout) {\n        timeout = setTimeout(later, remaining);\n      }\n      return result;\n    };\n  };\n\n  // Returns a function, that, as long as it continues to be invoked, will not\n  // be triggered. The function will be called after it stops being called for\n  // N milliseconds. If `immediate` is passed, trigger the function on the\n  // leading edge, instead of the trailing.\n  _.debounce = function(func, wait, immediate) {\n    var timeout, result;\n    return function() {\n      var context = this, args = arguments;\n      var later = function() {\n        timeout = null;\n        if (!immediate) result = func.apply(context, args);\n      };\n      var callNow = immediate && !timeout;\n      clearTimeout(timeout);\n      timeout = setTimeout(later, wait);\n      if (callNow) result = func.apply(context, args);\n      return result;\n    };\n  };\n\n  // Returns a function that will be executed at most one time, no matter how\n  // often you call it. Useful for lazy initialization.\n  _.once = function(func) {\n    var ran = false, memo;\n    return function() {\n      if (ran) return memo;\n      ran = true;\n      memo = func.apply(this, arguments);\n      func = null;\n      return memo;\n    };\n  };\n\n  // Returns the first function passed as an argument to the second,\n  // allowing you to adjust arguments, run code before and after, and\n  // conditionally execute the original function.\n  _.wrap = function(func, wrapper) {\n    return function() {\n      var args = [func];\n      push.apply(args, arguments);\n      return wrapper.apply(this, args);\n    };\n  };\n\n  // Returns a function that is the composition of a list of functions, each\n  // consuming the return value of the function that follows.\n  _.compose = function() {\n    var funcs = arguments;\n    return function() {\n      var args = arguments;\n      for (var i = funcs.length - 1; i >= 0; i--) {\n        args = [funcs[i].apply(this, args)];\n      }\n      return args[0];\n    };\n  };\n\n  // Returns a function that will only be executed after being called N times.\n  _.after = function(times, func) {\n    if (times <= 0) return func();\n    return function() {\n      if (--times < 1) {\n        return func.apply(this, arguments);\n      }\n    };\n  };\n\n  // Object Functions\n  // ----------------\n\n  // Retrieve the names of an object's properties.\n  // Delegates to **ECMAScript 5**'s native `Object.keys`\n  _.keys = nativeKeys || function(obj) {\n    if (obj !== Object(obj)) throw new TypeError('Invalid object');\n    var keys = [];\n    for (var key in obj) if (_.has(obj, key)) keys[keys.length] = key;\n    return keys;\n  };\n\n  // Retrieve the values of an object's properties.\n  _.values = function(obj) {\n    var values = [];\n    for (var key in obj) if (_.has(obj, key)) values.push(obj[key]);\n    return values;\n  };\n\n  // Convert an object into a list of `[key, value]` pairs.\n  _.pairs = function(obj) {\n    var pairs = [];\n    for (var key in obj) if (_.has(obj, key)) pairs.push([key, obj[key]]);\n    return pairs;\n  };\n\n  // Invert the keys and values of an object. The values must be serializable.\n  _.invert = function(obj) {\n    var result = {};\n    for (var key in obj) if (_.has(obj, key)) result[obj[key]] = key;\n    return result;\n  };\n\n  // Return a sorted list of the function names available on the object.\n  // Aliased as `methods`\n  _.functions = _.methods = function(obj) {\n    var names = [];\n    for (var key in obj) {\n      if (_.isFunction(obj[key])) names.push(key);\n    }\n    return names.sort();\n  };\n\n  // Extend a given object with all the properties in passed-in object(s).\n  _.extend = function(obj) {\n    each(slice.call(arguments, 1), function(source) {\n      if (source) {\n        for (var prop in source) {\n          obj[prop] = source[prop];\n        }\n      }\n    });\n    return obj;\n  };\n\n  // Return a copy of the object only containing the whitelisted properties.\n  _.pick = function(obj) {\n    var copy = {};\n    var keys = concat.apply(ArrayProto, slice.call(arguments, 1));\n    each(keys, function(key) {\n      if (key in obj) copy[key] = obj[key];\n    });\n    return copy;\n  };\n\n   // Return a copy of the object without the blacklisted properties.\n  _.omit = function(obj) {\n    var copy = {};\n    var keys = concat.apply(ArrayProto, slice.call(arguments, 1));\n    for (var key in obj) {\n      if (!_.contains(keys, key)) copy[key] = obj[key];\n    }\n    return copy;\n  };\n\n  // Fill in a given object with default properties.\n  _.defaults = function(obj) {\n    each(slice.call(arguments, 1), function(source) {\n      if (source) {\n        for (var prop in source) {\n          if (obj[prop] == null) obj[prop] = source[prop];\n        }\n      }\n    });\n    return obj;\n  };\n\n  // Create a (shallow-cloned) duplicate of an object.\n  _.clone = function(obj) {\n    if (!_.isObject(obj)) return obj;\n    return _.isArray(obj) ? obj.slice() : _.extend({}, obj);\n  };\n\n  // Invokes interceptor with the obj, and then returns obj.\n  // The primary purpose of this method is to \"tap into\" a method chain, in\n  // order to perform operations on intermediate results within the chain.\n  _.tap = function(obj, interceptor) {\n    interceptor(obj);\n    return obj;\n  };\n\n  // Internal recursive comparison function for `isEqual`.\n  var eq = function(a, b, aStack, bStack) {\n    // Identical objects are equal. `0 === -0`, but they aren't identical.\n    // See the Harmony `egal` proposal: http://wiki.ecmascript.org/doku.php?id=harmony:egal.\n    if (a === b) return a !== 0 || 1 / a == 1 / b;\n    // A strict comparison is necessary because `null == undefined`.\n    if (a == null || b == null) return a === b;\n    // Unwrap any wrapped objects.\n    if (a instanceof _) a = a._wrapped;\n    if (b instanceof _) b = b._wrapped;\n    // Compare `[[Class]]` names.\n    var className = toString.call(a);\n    if (className != toString.call(b)) return false;\n    switch (className) {\n      // Strings, numbers, dates, and booleans are compared by value.\n      case '[object String]':\n        // Primitives and their corresponding object wrappers are equivalent; thus, `\"5\"` is\n        // equivalent to `new String(\"5\")`.\n        return a == String(b);\n      case '[object Number]':\n        // `NaN`s are equivalent, but non-reflexive. An `egal` comparison is performed for\n        // other numeric values.\n        return a != +a ? b != +b : (a == 0 ? 1 / a == 1 / b : a == +b);\n      case '[object Date]':\n      case '[object Boolean]':\n        // Coerce dates and booleans to numeric primitive values. Dates are compared by their\n        // millisecond representations. Note that invalid dates with millisecond representations\n        // of `NaN` are not equivalent.\n        return +a == +b;\n      // RegExps are compared by their source patterns and flags.\n      case '[object RegExp]':\n        return a.source == b.source &&\n               a.global == b.global &&\n               a.multiline == b.multiline &&\n               a.ignoreCase == b.ignoreCase;\n    }\n    if (typeof a != 'object' || typeof b != 'object') return false;\n    // Assume equality for cyclic structures. The algorithm for detecting cyclic\n    // structures is adapted from ES 5.1 section 15.12.3, abstract operation `JO`.\n    var length = aStack.length;\n    while (length--) {\n      // Linear search. Performance is inversely proportional to the number of\n      // unique nested structures.\n      if (aStack[length] == a) return bStack[length] == b;\n    }\n    // Add the first object to the stack of traversed objects.\n    aStack.push(a);\n    bStack.push(b);\n    var size = 0, result = true;\n    // Recursively compare objects and arrays.\n    if (className == '[object Array]') {\n      // Compare array lengths to determine if a deep comparison is necessary.\n      size = a.length;\n      result = size == b.length;\n      if (result) {\n        // Deep compare the contents, ignoring non-numeric properties.\n        while (size--) {\n          if (!(result = eq(a[size], b[size], aStack, bStack))) break;\n        }\n      }\n    } else {\n      // Objects with different constructors are not equivalent, but `Object`s\n      // from different frames are.\n      var aCtor = a.constructor, bCtor = b.constructor;\n      if (aCtor !== bCtor && !(_.isFunction(aCtor) && (aCtor instanceof aCtor) &&\n                               _.isFunction(bCtor) && (bCtor instanceof bCtor))) {\n        return false;\n      }\n      // Deep compare objects.\n      for (var key in a) {\n        if (_.has(a, key)) {\n          // Count the expected number of properties.\n          size++;\n          // Deep compare each member.\n          if (!(result = _.has(b, key) && eq(a[key], b[key], aStack, bStack))) break;\n        }\n      }\n      // Ensure that both objects contain the same number of properties.\n      if (result) {\n        for (key in b) {\n          if (_.has(b, key) && !(size--)) break;\n        }\n        result = !size;\n      }\n    }\n    // Remove the first object from the stack of traversed objects.\n    aStack.pop();\n    bStack.pop();\n    return result;\n  };\n\n  // Perform a deep comparison to check if two objects are equal.\n  _.isEqual = function(a, b) {\n    return eq(a, b, [], []);\n  };\n\n  // Is a given array, string, or object empty?\n  // An \"empty\" object has no enumerable own-properties.\n  _.isEmpty = function(obj) {\n    if (obj == null) return true;\n    if (_.isArray(obj) || _.isString(obj)) return obj.length === 0;\n    for (var key in obj) if (_.has(obj, key)) return false;\n    return true;\n  };\n\n  // Is a given value a DOM element?\n  _.isElement = function(obj) {\n    return !!(obj && obj.nodeType === 1);\n  };\n\n  // Is a given value an array?\n  // Delegates to ECMA5's native Array.isArray\n  _.isArray = nativeIsArray || function(obj) {\n    return toString.call(obj) == '[object Array]';\n  };\n\n  // Is a given variable an object?\n  _.isObject = function(obj) {\n    return obj === Object(obj);\n  };\n\n  // Add some isType methods: isArguments, isFunction, isString, isNumber, isDate, isRegExp.\n  each(['Arguments', 'Function', 'String', 'Number', 'Date', 'RegExp'], function(name) {\n    _['is' + name] = function(obj) {\n      return toString.call(obj) == '[object ' + name + ']';\n    };\n  });\n\n  // Define a fallback version of the method in browsers (ahem, IE), where\n  // there isn't any inspectable \"Arguments\" type.\n  if (!_.isArguments(arguments)) {\n    _.isArguments = function(obj) {\n      return !!(obj && _.has(obj, 'callee'));\n    };\n  }\n\n  // Optimize `isFunction` if appropriate.\n  if (typeof (/./) !== 'function') {\n    _.isFunction = function(obj) {\n      return typeof obj === 'function';\n    };\n  }\n\n  // Is a given object a finite number?\n  _.isFinite = function(obj) {\n    return isFinite(obj) && !isNaN(parseFloat(obj));\n  };\n\n  // Is the given value `NaN`? (NaN is the only number which does not equal itself).\n  _.isNaN = function(obj) {\n    return _.isNumber(obj) && obj != +obj;\n  };\n\n  // Is a given value a boolean?\n  _.isBoolean = function(obj) {\n    return obj === true || obj === false || toString.call(obj) == '[object Boolean]';\n  };\n\n  // Is a given value equal to null?\n  _.isNull = function(obj) {\n    return obj === null;\n  };\n\n  // Is a given variable undefined?\n  _.isUndefined = function(obj) {\n    return obj === void 0;\n  };\n\n  // Shortcut function for checking if an object has a given property directly\n  // on itself (in other words, not on a prototype).\n  _.has = function(obj, key) {\n    return hasOwnProperty.call(obj, key);\n  };\n\n  // Utility Functions\n  // -----------------\n\n  // Run Underscore.js in *noConflict* mode, returning the `_` variable to its\n  // previous owner. Returns a reference to the Underscore object.\n  _.noConflict = function() {\n    root._ = previousUnderscore;\n    return this;\n  };\n\n  // Keep the identity function around for default iterators.\n  _.identity = function(value) {\n    return value;\n  };\n\n  // Run a function **n** times.\n  _.times = function(n, iterator, context) {\n    var accum = Array(n);\n    for (var i = 0; i < n; i++) accum[i] = iterator.call(context, i);\n    return accum;\n  };\n\n  // Return a random integer between min and max (inclusive).\n  _.random = function(min, max) {\n    if (max == null) {\n      max = min;\n      min = 0;\n    }\n    return min + Math.floor(Math.random() * (max - min + 1));\n  };\n\n  // List of HTML entities for escaping.\n  var entityMap = {\n    escape: {\n      '&': '&amp;',\n      '<': '&lt;',\n      '>': '&gt;',\n      '\"': '&quot;',\n      \"'\": '&#x27;',\n      '/': '&#x2F;'\n    }\n  };\n  entityMap.unescape = _.invert(entityMap.escape);\n\n  // Regexes containing the keys and values listed immediately above.\n  var entityRegexes = {\n    escape:   new RegExp('[' + _.keys(entityMap.escape).join('') + ']', 'g'),\n    unescape: new RegExp('(' + _.keys(entityMap.unescape).join('|') + ')', 'g')\n  };\n\n  // Functions for escaping and unescaping strings to/from HTML interpolation.\n  _.each(['escape', 'unescape'], function(method) {\n    _[method] = function(string) {\n      if (string == null) return '';\n      return ('' + string).replace(entityRegexes[method], function(match) {\n        return entityMap[method][match];\n      });\n    };\n  });\n\n  // If the value of the named property is a function then invoke it;\n  // otherwise, return it.\n  _.result = function(object, property) {\n    if (object == null) return null;\n    var value = object[property];\n    return _.isFunction(value) ? value.call(object) : value;\n  };\n\n  // Add your own custom functions to the Underscore object.\n  _.mixin = function(obj) {\n    each(_.functions(obj), function(name){\n      var func = _[name] = obj[name];\n      _.prototype[name] = function() {\n        var args = [this._wrapped];\n        push.apply(args, arguments);\n        return result.call(this, func.apply(_, args));\n      };\n    });\n  };\n\n  // Generate a unique integer id (unique within the entire client session).\n  // Useful for temporary DOM ids.\n  var idCounter = 0;\n  _.uniqueId = function(prefix) {\n    var id = ++idCounter + '';\n    return prefix ? prefix + id : id;\n  };\n\n  // By default, Underscore uses ERB-style template delimiters, change the\n  // following template settings to use alternative delimiters.\n  _.templateSettings = {\n    evaluate    : /<%([\\s\\S]+?)%>/g,\n    interpolate : /<%=([\\s\\S]+?)%>/g,\n    escape      : /<%-([\\s\\S]+?)%>/g\n  };\n\n  // When customizing `templateSettings`, if you don't want to define an\n  // interpolation, evaluation or escaping regex, we need one that is\n  // guaranteed not to match.\n  var noMatch = /(.)^/;\n\n  // Certain characters need to be escaped so that they can be put into a\n  // string literal.\n  var escapes = {\n    \"'\":      \"'\",\n    '\\\\':     '\\\\',\n    '\\r':     'r',\n    '\\n':     'n',\n    '\\t':     't',\n    '\\u2028': 'u2028',\n    '\\u2029': 'u2029'\n  };\n\n  var escaper = /\\\\|'|\\r|\\n|\\t|\\u2028|\\u2029/g;\n\n  // JavaScript micro-templating, similar to John Resig's implementation.\n  // Underscore templating handles arbitrary delimiters, preserves whitespace,\n  // and correctly escapes quotes within interpolated code.\n  _.template = function(text, data, settings) {\n    var render;\n    settings = _.defaults({}, settings, _.templateSettings);\n\n    // Combine delimiters into one regular expression via alternation.\n    var matcher = new RegExp([\n      (settings.escape || noMatch).source,\n      (settings.interpolate || noMatch).source,\n      (settings.evaluate || noMatch).source\n    ].join('|') + '|$', 'g');\n\n    // Compile the template source, escaping string literals appropriately.\n    var index = 0;\n    var source = \"__p+='\";\n    text.replace(matcher, function(match, escape, interpolate, evaluate, offset) {\n      source += text.slice(index, offset)\n        .replace(escaper, function(match) { return '\\\\' + escapes[match]; });\n\n      if (escape) {\n        source += \"'+\\n((__t=(\" + escape + \"))==null?'':_.escape(__t))+\\n'\";\n      }\n      if (interpolate) {\n        source += \"'+\\n((__t=(\" + interpolate + \"))==null?'':__t)+\\n'\";\n      }\n      if (evaluate) {\n        source += \"';\\n\" + evaluate + \"\\n__p+='\";\n      }\n      index = offset + match.length;\n      return match;\n    });\n    source += \"';\\n\";\n\n    // If a variable is not specified, place data values in local scope.\n    if (!settings.variable) source = 'with(obj||{}){\\n' + source + '}\\n';\n\n    source = \"var __t,__p='',__j=Array.prototype.join,\" +\n      \"print=function(){__p+=__j.call(arguments,'');};\\n\" +\n      source + \"return __p;\\n\";\n\n    try {\n      render = new Function(settings.variable || 'obj', '_', source);\n    } catch (e) {\n      e.source = source;\n      throw e;\n    }\n\n    if (data) return render(data, _);\n    var template = function(data) {\n      return render.call(this, data, _);\n    };\n\n    // Provide the compiled function source as a convenience for precompilation.\n    template.source = 'function(' + (settings.variable || 'obj') + '){\\n' + source + '}';\n\n    return template;\n  };\n\n  // Add a \"chain\" function, which will delegate to the wrapper.\n  _.chain = function(obj) {\n    return _(obj).chain();\n  };\n\n  // OOP\n  // ---------------\n  // If Underscore is called as a function, it returns a wrapped object that\n  // can be used OO-style. This wrapper holds altered versions of all the\n  // underscore functions. Wrapped objects may be chained.\n\n  // Helper function to continue chaining intermediate results.\n  var result = function(obj) {\n    return this._chain ? _(obj).chain() : obj;\n  };\n\n  // Add all of the Underscore functions to the wrapper object.\n  _.mixin(_);\n\n  // Add all mutator Array functions to the wrapper.\n  each(['pop', 'push', 'reverse', 'shift', 'sort', 'splice', 'unshift'], function(name) {\n    var method = ArrayProto[name];\n    _.prototype[name] = function() {\n      var obj = this._wrapped;\n      method.apply(obj, arguments);\n      if ((name == 'shift' || name == 'splice') && obj.length === 0) delete obj[0];\n      return result.call(this, obj);\n    };\n  });\n\n  // Add all accessor Array functions to the wrapper.\n  each(['concat', 'join', 'slice'], function(name) {\n    var method = ArrayProto[name];\n    _.prototype[name] = function() {\n      return result.call(this, method.apply(this._wrapped, arguments));\n    };\n  });\n\n  _.extend(_.prototype, {\n\n    // Start chaining a wrapped Underscore object.\n    chain: function() {\n      this._chain = true;\n      return this;\n    },\n\n    // Extracts the result from a wrapped and chained object.\n    value: function() {\n      return this._wrapped;\n    }\n\n  });\n\n}).call(this);\n","module.exports = require(\"crypto\");;","module.exports = require(\"electron\");;","module.exports = require(\"events\");;","module.exports = require(\"fs\");;","module.exports = require(\"path\");;","module.exports = require(\"util\");;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","const electron = require(\"electron\");\nconst { ipcMain } = require(\"electron\");\nconst { dialog } = require(\"electron\");\nconst app = electron.app;\nconst BrowserWindow = electron.BrowserWindow;\nimport {initIpcEvent} from \"./ipcCommut\";\n\ninitIpcEvent();\nlet mainWindow;\napp.on(\"ready\",()=>{\n    mainWindow = new BrowserWindow({width:900,height:600,\n        webPreferences:{\n            nodeIntegration: true,\n            contextIsolation: false\n        }\n    });\n    mainWindow.loadURL(`file://${__dirname}/index.html`);\n    mainWindow.webContents.openDevTools();\n    mainWindow.on(\"closed\",()=>{\n        mainWindow = null;\n    });\n});","const electron = require(\"electron\");\nconst { ipcMain } = require(\"electron\");\nconst { dialog } = require(\"electron\");\nconst app = electron.app;\n\nconst DataStore = require(\"nedb\");\n\nexport const initIpcEvent = async() =>{\n    const strage = (()=>{\n        try{\n            return `${app.getPath(\"appData\")}/customClockStrage`;\n            //console.log(app.getPath(\"documents\"));\n        }catch(e){\n            console.log(e);\n        }\n    })();\n\n    const db = new DataStore({\n        filename:`${strage}/clock.db`,\n        //filename:databasePath,\n        autoload:true\n    });\n\n    ipcMain.handle(\"getImgPath\",event=>{\n        const image = dialog.showOpenDialog({properties:[\"openFile\"],\n            filters:[{name:\"images\",extensions:[\"jpg\",\"png\",\"gif\"]}]\n        });\n        return image;\n    });\n\n    ipcMain.handle(\"recordData\",(event,docs)=>{\n        return new Promise((resolve,reject)=>{\n            db.remove({},{ multi: true },(err)=>{\n                if(err)reject(err);\n                db.insert(docs,(err,newDocs)=>{\n                    if(err)reject(err);\n                    console.log(newDocs);\n                    resolve(true);\n                });\n            });\n        });\n    });\n\n    ipcMain.handle(\"loadData\",event=>{\n        return new Promise((resolve,reject)=>{\n            db.find({},(err,docs)=>{\n                if(err)reject(err);\n                resolve(docs);\n            })\n        })\n    })\n}"],"sourceRoot":""}